function Gt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var lt={exports:{}},on;function Or(){return on||(on=1,(function(e,t){(function(n){e.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(h,d){var o=h[0],a=h[1],c=h[2],f=h[3];o+=(a&c|~a&f)+d[0]-680876936|0,o=(o<<7|o>>>25)+a|0,f+=(o&a|~o&c)+d[1]-389564586|0,f=(f<<12|f>>>20)+o|0,c+=(f&o|~f&a)+d[2]+606105819|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&o)+d[3]-1044525330|0,a=(a<<22|a>>>10)+c|0,o+=(a&c|~a&f)+d[4]-176418897|0,o=(o<<7|o>>>25)+a|0,f+=(o&a|~o&c)+d[5]+1200080426|0,f=(f<<12|f>>>20)+o|0,c+=(f&o|~f&a)+d[6]-1473231341|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&o)+d[7]-45705983|0,a=(a<<22|a>>>10)+c|0,o+=(a&c|~a&f)+d[8]+1770035416|0,o=(o<<7|o>>>25)+a|0,f+=(o&a|~o&c)+d[9]-1958414417|0,f=(f<<12|f>>>20)+o|0,c+=(f&o|~f&a)+d[10]-42063|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&o)+d[11]-1990404162|0,a=(a<<22|a>>>10)+c|0,o+=(a&c|~a&f)+d[12]+1804603682|0,o=(o<<7|o>>>25)+a|0,f+=(o&a|~o&c)+d[13]-40341101|0,f=(f<<12|f>>>20)+o|0,c+=(f&o|~f&a)+d[14]-1502002290|0,c=(c<<17|c>>>15)+f|0,a+=(c&f|~c&o)+d[15]+1236535329|0,a=(a<<22|a>>>10)+c|0,o+=(a&f|c&~f)+d[1]-165796510|0,o=(o<<5|o>>>27)+a|0,f+=(o&c|a&~c)+d[6]-1069501632|0,f=(f<<9|f>>>23)+o|0,c+=(f&a|o&~a)+d[11]+643717713|0,c=(c<<14|c>>>18)+f|0,a+=(c&o|f&~o)+d[0]-373897302|0,a=(a<<20|a>>>12)+c|0,o+=(a&f|c&~f)+d[5]-701558691|0,o=(o<<5|o>>>27)+a|0,f+=(o&c|a&~c)+d[10]+38016083|0,f=(f<<9|f>>>23)+o|0,c+=(f&a|o&~a)+d[15]-660478335|0,c=(c<<14|c>>>18)+f|0,a+=(c&o|f&~o)+d[4]-405537848|0,a=(a<<20|a>>>12)+c|0,o+=(a&f|c&~f)+d[9]+568446438|0,o=(o<<5|o>>>27)+a|0,f+=(o&c|a&~c)+d[14]-1019803690|0,f=(f<<9|f>>>23)+o|0,c+=(f&a|o&~a)+d[3]-187363961|0,c=(c<<14|c>>>18)+f|0,a+=(c&o|f&~o)+d[8]+1163531501|0,a=(a<<20|a>>>12)+c|0,o+=(a&f|c&~f)+d[13]-1444681467|0,o=(o<<5|o>>>27)+a|0,f+=(o&c|a&~c)+d[2]-51403784|0,f=(f<<9|f>>>23)+o|0,c+=(f&a|o&~a)+d[7]+1735328473|0,c=(c<<14|c>>>18)+f|0,a+=(c&o|f&~o)+d[12]-1926607734|0,a=(a<<20|a>>>12)+c|0,o+=(a^c^f)+d[5]-378558|0,o=(o<<4|o>>>28)+a|0,f+=(o^a^c)+d[8]-2022574463|0,f=(f<<11|f>>>21)+o|0,c+=(f^o^a)+d[11]+1839030562|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^o)+d[14]-35309556|0,a=(a<<23|a>>>9)+c|0,o+=(a^c^f)+d[1]-1530992060|0,o=(o<<4|o>>>28)+a|0,f+=(o^a^c)+d[4]+1272893353|0,f=(f<<11|f>>>21)+o|0,c+=(f^o^a)+d[7]-155497632|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^o)+d[10]-1094730640|0,a=(a<<23|a>>>9)+c|0,o+=(a^c^f)+d[13]+681279174|0,o=(o<<4|o>>>28)+a|0,f+=(o^a^c)+d[0]-358537222|0,f=(f<<11|f>>>21)+o|0,c+=(f^o^a)+d[3]-722521979|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^o)+d[6]+76029189|0,a=(a<<23|a>>>9)+c|0,o+=(a^c^f)+d[9]-640364487|0,o=(o<<4|o>>>28)+a|0,f+=(o^a^c)+d[12]-421815835|0,f=(f<<11|f>>>21)+o|0,c+=(f^o^a)+d[15]+530742520|0,c=(c<<16|c>>>16)+f|0,a+=(c^f^o)+d[2]-995338651|0,a=(a<<23|a>>>9)+c|0,o+=(c^(a|~f))+d[0]-198630844|0,o=(o<<6|o>>>26)+a|0,f+=(a^(o|~c))+d[7]+1126891415|0,f=(f<<10|f>>>22)+o|0,c+=(o^(f|~a))+d[14]-1416354905|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~o))+d[5]-57434055|0,a=(a<<21|a>>>11)+c|0,o+=(c^(a|~f))+d[12]+1700485571|0,o=(o<<6|o>>>26)+a|0,f+=(a^(o|~c))+d[3]-1894986606|0,f=(f<<10|f>>>22)+o|0,c+=(o^(f|~a))+d[10]-1051523|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~o))+d[1]-2054922799|0,a=(a<<21|a>>>11)+c|0,o+=(c^(a|~f))+d[8]+1873313359|0,o=(o<<6|o>>>26)+a|0,f+=(a^(o|~c))+d[15]-30611744|0,f=(f<<10|f>>>22)+o|0,c+=(o^(f|~a))+d[6]-1560198380|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~o))+d[13]+1309151649|0,a=(a<<21|a>>>11)+c|0,o+=(c^(a|~f))+d[4]-145523070|0,o=(o<<6|o>>>26)+a|0,f+=(a^(o|~c))+d[11]-1120210379|0,f=(f<<10|f>>>22)+o|0,c+=(o^(f|~a))+d[2]+718787259|0,c=(c<<15|c>>>17)+f|0,a+=(f^(c|~o))+d[9]-343485551|0,a=(a<<21|a>>>11)+c|0,h[0]=o+h[0]|0,h[1]=a+h[1]|0,h[2]=c+h[2]|0,h[3]=f+h[3]|0}function s(h){var d=[],o;for(o=0;o<64;o+=4)d[o>>2]=h.charCodeAt(o)+(h.charCodeAt(o+1)<<8)+(h.charCodeAt(o+2)<<16)+(h.charCodeAt(o+3)<<24);return d}function u(h){var d=[],o;for(o=0;o<64;o+=4)d[o>>2]=h[o]+(h[o+1]<<8)+(h[o+2]<<16)+(h[o+3]<<24);return d}function v(h){var d=h.length,o=[1732584193,-271733879,-1732584194,271733878],a,c,f,q,C,E;for(a=64;a<=d;a+=64)i(o,s(h.substring(a-64,a)));for(h=h.substring(a-64),c=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)f[a>>2]|=h.charCodeAt(a)<<(a%4<<3);if(f[a>>2]|=128<<(a%4<<3),a>55)for(i(o,f),a=0;a<16;a+=1)f[a]=0;return q=d*8,q=q.toString(16).match(/(.*?)(.{0,8})$/),C=parseInt(q[2],16),E=parseInt(q[1],16)||0,f[14]=C,f[15]=E,i(o,f),o}function _(h){var d=h.length,o=[1732584193,-271733879,-1732584194,271733878],a,c,f,q,C,E;for(a=64;a<=d;a+=64)i(o,u(h.subarray(a-64,a)));for(h=a-64<d?h.subarray(a-64):new Uint8Array(0),c=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<c;a+=1)f[a>>2]|=h[a]<<(a%4<<3);if(f[a>>2]|=128<<(a%4<<3),a>55)for(i(o,f),a=0;a<16;a+=1)f[a]=0;return q=d*8,q=q.toString(16).match(/(.*?)(.{0,8})$/),C=parseInt(q[2],16),E=parseInt(q[1],16)||0,f[14]=C,f[15]=E,i(o,f),o}function y(h){var d="",o;for(o=0;o<4;o+=1)d+=r[h>>o*8+4&15]+r[h>>o*8&15];return d}function w(h){var d;for(d=0;d<h.length;d+=1)h[d]=y(h[d]);return h.join("")}w(v("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function h(d,o){return d=d|0||0,d<0?Math.max(d+o,0):Math.min(d,o)}ArrayBuffer.prototype.slice=function(d,o){var a=this.byteLength,c=h(d,a),f=a,q,C,E,P;return o!==n&&(f=h(o,a)),c>f?new ArrayBuffer(0):(q=f-c,C=new ArrayBuffer(q),E=new Uint8Array(C),P=new Uint8Array(this,c,q),E.set(P),C)}})();function l(h){return/[\u0080-\uFFFF]/.test(h)&&(h=unescape(encodeURIComponent(h))),h}function g(h,d){var o=h.length,a=new ArrayBuffer(o),c=new Uint8Array(a),f;for(f=0;f<o;f+=1)c[f]=h.charCodeAt(f);return d?c:a}function m(h){return String.fromCharCode.apply(null,new Uint8Array(h))}function S(h,d,o){var a=new Uint8Array(h.byteLength+d.byteLength);return a.set(new Uint8Array(h)),a.set(new Uint8Array(d),h.byteLength),a}function O(h){var d=[],o=h.length,a;for(a=0;a<o-1;a+=2)d.push(parseInt(h.substr(a,2),16));return String.fromCharCode.apply(String,d)}function p(){this.reset()}return p.prototype.append=function(h){return this.appendBinary(l(h)),this},p.prototype.appendBinary=function(h){this._buff+=h,this._length+=h.length;var d=this._buff.length,o;for(o=64;o<=d;o+=64)i(this._hash,s(this._buff.substring(o-64,o)));return this._buff=this._buff.substring(o-64),this},p.prototype.end=function(h){var d=this._buff,o=d.length,a,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f;for(a=0;a<o;a+=1)c[a>>2]|=d.charCodeAt(a)<<(a%4<<3);return this._finish(c,o),f=w(this._hash),h&&(f=O(f)),this.reset(),f},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(h){return this._buff=h.buff,this._length=h.length,this._hash=h.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(h,d){var o=d,a,c,f;if(h[o>>2]|=128<<(o%4<<3),o>55)for(i(this._hash,h),o=0;o<16;o+=1)h[o]=0;a=this._length*8,a=a.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(a[2],16),f=parseInt(a[1],16)||0,h[14]=c,h[15]=f,i(this._hash,h)},p.hash=function(h,d){return p.hashBinary(l(h),d)},p.hashBinary=function(h,d){var o=v(h),a=w(o);return d?O(a):a},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(h){var d=S(this._buff.buffer,h),o=d.length,a;for(this._length+=h.byteLength,a=64;a<=o;a+=64)i(this._hash,u(d.subarray(a-64,a)));return this._buff=a-64<o?new Uint8Array(d.buffer.slice(a-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(h){var d=this._buff,o=d.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c,f;for(c=0;c<o;c+=1)a[c>>2]|=d[c]<<(c%4<<3);return this._finish(a,o),f=w(this._hash),h&&(f=O(f)),this.reset(),f},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var h=p.prototype.getState.call(this);return h.buff=m(h.buff),h},p.ArrayBuffer.prototype.setState=function(h){return h.buff=g(h.buff,!0),p.prototype.setState.call(this,h)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(h,d){var o=_(new Uint8Array(h)),a=w(o);return d?O(a):a},p})})(lt)),lt.exports}var Cr=Or();const Ct=Gt(Cr);var We,xr=new Uint8Array(16);function Er(){if(!We&&(We=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!We))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return We(xr)}const kr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Dr(e){return typeof e=="string"&&kr.test(e)}var ue=[];for(var dt=0;dt<256;++dt)ue.push((dt+256).toString(16).substr(1));function Tr(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(ue[e[t+0]]+ue[e[t+1]]+ue[e[t+2]]+ue[e[t+3]]+"-"+ue[e[t+4]]+ue[e[t+5]]+"-"+ue[e[t+6]]+ue[e[t+7]]+"-"+ue[e[t+8]]+ue[e[t+9]]+"-"+ue[e[t+10]]+ue[e[t+11]]+ue[e[t+12]]+ue[e[t+13]]+ue[e[t+14]]+ue[e[t+15]]).toLowerCase();if(!Dr(n))throw TypeError("Stringified UUID is invalid");return n}function Jt(e,t,n){e=e||{};var r=e.random||(e.rng||Er)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return Tr(r)}var He={},un;function Pr(){if(un)return He;un=1,He.stringify=function(n){var r=[];r.push({obj:n});for(var i="",s,u,v,_,y,w,l,g,m,S,O;s=r.pop();)if(u=s.obj,v=s.prefix||"",_=s.val||"",i+=v,_)i+=_;else if(typeof u!="object")i+=typeof u>"u"?null:JSON.stringify(u);else if(u===null)i+="null";else if(Array.isArray(u)){for(r.push({val:"]"}),y=u.length-1;y>=0;y--)w=y===0?"":",",r.push({obj:u[y],prefix:w});r.push({val:"["})}else{l=[];for(g in u)u.hasOwnProperty(g)&&l.push(g);for(r.push({val:"}"}),y=l.length-1;y>=0;y--)m=l[y],S=u[m],O=y>0?",":"",O+=JSON.stringify(m)+":",r.push({obj:S,prefix:O});r.push({val:"{"})}return i};function e(t,n,r){var i=r[r.length-1];t===i.element&&(r.pop(),i=r[r.length-1]);var s=i.element,u=i.index;if(Array.isArray(s))s.push(t);else if(u===n.length-2){var v=n.pop();s[v]=t}else n.push(t)}return He.parse=function(t){for(var n=[],r=[],i=0,s,u,v,_,y,w,l,g,m;;){if(s=t[i++],s==="}"||s==="]"||typeof s>"u"){if(n.length===1)return n.pop();e(n.pop(),n,r);continue}switch(s){case" ":case"	":case`
`:case":":case",":break;case"n":i+=3,e(null,n,r);break;case"t":i+=3,e(!0,n,r);break;case"f":i+=4,e(!1,n,r);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(u="",i--;;)if(v=t[i++],/[\d\.\-e\+]/.test(v))u+=v;else{i--;break}e(parseFloat(u),n,r);break;case'"':for(_="",y=void 0,w=0;l=t[i++],l!=='"'||y==="\\"&&w%2===1;)_+=l,y=l,y==="\\"?w++:w=0;e(JSON.parse('"'+_+'"'),n,r);break;case"[":g={element:[],index:n.length},n.push(g.element),r.push(g);break;case"{":m={element:{},index:n.length},n.push(m.element),r.push(m);break;default:throw new Error("unexpectedly reached end of input: "+s)}}},He}var Rr=Pr();const Mn=Gt(Rr);var Xe={exports:{}},cn;function Lr(){if(cn)return Xe.exports;cn=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(c,f,q){return Function.prototype.apply.call(c,f,q)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(c){return Object.getOwnPropertyNames(c).concat(Object.getOwnPropertySymbols(c))}:n=function(c){return Object.getOwnPropertyNames(c)};function r(a){console&&console.warn&&console.warn(a)}var i=Number.isNaN||function(c){return c!==c};function s(){s.init.call(this)}Xe.exports=s,Xe.exports.once=h,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var u=10;function v(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(a){if(typeof a!="number"||a<0||i(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");u=a}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(c){if(typeof c!="number"||c<0||i(c))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+c+".");return this._maxListeners=c,this};function _(a){return a._maxListeners===void 0?s.defaultMaxListeners:a._maxListeners}s.prototype.getMaxListeners=function(){return _(this)},s.prototype.emit=function(c){for(var f=[],q=1;q<arguments.length;q++)f.push(arguments[q]);var C=c==="error",E=this._events;if(E!==void 0)C=C&&E.error===void 0;else if(!C)return!1;if(C){var P;if(f.length>0&&(P=f[0]),P instanceof Error)throw P;var B=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw B.context=P,B}var F=E[c];if(F===void 0)return!1;if(typeof F=="function")t(F,this,f);else for(var j=F.length,N=S(F,j),q=0;q<j;++q)t(N[q],this,f);return!0};function y(a,c,f,q){var C,E,P;if(v(f),E=a._events,E===void 0?(E=a._events=Object.create(null),a._eventsCount=0):(E.newListener!==void 0&&(a.emit("newListener",c,f.listener?f.listener:f),E=a._events),P=E[c]),P===void 0)P=E[c]=f,++a._eventsCount;else if(typeof P=="function"?P=E[c]=q?[f,P]:[P,f]:q?P.unshift(f):P.push(f),C=_(a),C>0&&P.length>C&&!P.warned){P.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(c)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=a,B.type=c,B.count=P.length,r(B)}return a}s.prototype.addListener=function(c,f){return y(this,c,f,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(c,f){return y(this,c,f,!0)};function w(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(a,c,f){var q={fired:!1,wrapFn:void 0,target:a,type:c,listener:f},C=w.bind(q);return C.listener=f,q.wrapFn=C,C}s.prototype.once=function(c,f){return v(f),this.on(c,l(this,c,f)),this},s.prototype.prependOnceListener=function(c,f){return v(f),this.prependListener(c,l(this,c,f)),this},s.prototype.removeListener=function(c,f){var q,C,E,P,B;if(v(f),C=this._events,C===void 0)return this;if(q=C[c],q===void 0)return this;if(q===f||q.listener===f)--this._eventsCount===0?this._events=Object.create(null):(delete C[c],C.removeListener&&this.emit("removeListener",c,q.listener||f));else if(typeof q!="function"){for(E=-1,P=q.length-1;P>=0;P--)if(q[P]===f||q[P].listener===f){B=q[P].listener,E=P;break}if(E<0)return this;E===0?q.shift():O(q,E),q.length===1&&(C[c]=q[0]),C.removeListener!==void 0&&this.emit("removeListener",c,B||f)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(c){var f,q,C;if(q=this._events,q===void 0)return this;if(q.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):q[c]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete q[c]),this;if(arguments.length===0){var E=Object.keys(q),P;for(C=0;C<E.length;++C)P=E[C],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(f=q[c],typeof f=="function")this.removeListener(c,f);else if(f!==void 0)for(C=f.length-1;C>=0;C--)this.removeListener(c,f[C]);return this};function g(a,c,f){var q=a._events;if(q===void 0)return[];var C=q[c];return C===void 0?[]:typeof C=="function"?f?[C.listener||C]:[C]:f?p(C):S(C,C.length)}s.prototype.listeners=function(c){return g(this,c,!0)},s.prototype.rawListeners=function(c){return g(this,c,!1)},s.listenerCount=function(a,c){return typeof a.listenerCount=="function"?a.listenerCount(c):m.call(a,c)},s.prototype.listenerCount=m;function m(a){var c=this._events;if(c!==void 0){var f=c[a];if(typeof f=="function")return 1;if(f!==void 0)return f.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function S(a,c){for(var f=new Array(c),q=0;q<c;++q)f[q]=a[q];return f}function O(a,c){for(;c+1<a.length;c++)a[c]=a[c+1];a.pop()}function p(a){for(var c=new Array(a.length),f=0;f<c.length;++f)c[f]=a[f].listener||a[f];return c}function h(a,c){return new Promise(function(f,q){function C(P){a.removeListener(c,E),q(P)}function E(){typeof a.removeListener=="function"&&a.removeListener("error",C),f([].slice.call(arguments))}o(a,c,E,{once:!0}),c!=="error"&&d(a,C,{once:!0})})}function d(a,c,f){typeof a.on=="function"&&o(a,"error",c,f)}function o(a,c,f,q){if(typeof a.on=="function")q.once?a.once(c,f):a.on(c,f);else if(typeof a.addEventListener=="function")a.addEventListener(c,function C(E){q.once&&a.removeEventListener(c,C),f(E)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}return Xe.exports}var Br=Lr();const Ce=Gt(Br);function Ir(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer||typeof Blob<"u"&&e instanceof Blob}function jr(e){return e instanceof ArrayBuffer?e.slice(0):e.slice(0,e.size,e.type)}var Fn=Function.prototype.toString,$r=Fn.call(Object);function Nr(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&Fn.call(n)==$r}function ae(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=ae(e[n]);return t}if(e instanceof Date&&isFinite(e))return e.toISOString();if(Ir(e))return jr(e);if(!Nr(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=ae(e[n]);typeof i<"u"&&(t[n]=i)}return t}function Un(e){var t=!1;return function(...n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)}}function Gn(e){return function(...t){t=ae(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(s,u){var v;try{var _=Un(function(y,w){y?u(y):s(w)});t.push(_),v=e.apply(n,t),v&&typeof v.then=="function"&&s(v)}catch(y){u(y)}});return r&&i.then(function(s){r(null,s)},r),i}}function Kr(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var s=n[n.length-1];n[n.length-1]=function(u,v){var _=["api",e.name,t];_=_.concat(u?["error",u]:["success",v]),e.constructor.emit("debug",_),s(u,v)}}}function te(e,t){return Gn(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return Kr(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,s){r.taskqueue.addTask(function(u){u?s(u):i(r[e].apply(r,n))})})})}function Je(e,t){for(var n={},r=0,i=t.length;r<i;r++){var s=t[r];s in e&&(n[s]=e[s])}return n}var Mr=6;function fn(e){return e}function Fr(e){return[{ok:e}]}function Jn(e,t,n){var r=t.docs,i=new Map;r.forEach(function(O){i.has(O.id)?i.get(O.id).push(O):i.set(O.id,[O])});var s=i.size,u=0,v=new Array(s);function _(){var O=[];v.forEach(function(p){p.docs.forEach(function(h){O.push({id:p.id,docs:[h]})})}),n(null,{results:O})}function y(){++u===s&&_()}function w(O,p,h){v[O]={id:p,docs:h},y()}var l=[];i.forEach(function(O,p){l.push(p)});var g=0;function m(){if(!(g>=l.length)){var O=Math.min(g+Mr,l.length),p=l.slice(g,O);S(p,g),g+=p.length}}function S(O,p){O.forEach(function(h,d){var o=p+d,a=i.get(h),c=Je(a[0],["atts_since","attachments"]);c.open_revs=a.map(function(q){return q.rev}),c.open_revs=c.open_revs.filter(fn);var f=fn;c.open_revs.length===0&&(delete c.open_revs,f=Fr),["revs","attachments","binary","ajax","latest"].forEach(function(q){q in t&&(c[q]=t[q])}),e.get(h,c,function(q,C){var E;q?E=[{error:q}]:E=f(C),w(o,h,E),m()})})}m()}var xt;try{localStorage.setItem("_pouch_check_localstorage",1),xt=!!localStorage.getItem("_pouch_check_localstorage")}catch{xt=!1}function tt(){return xt}const qe=typeof queueMicrotask=="function"?queueMicrotask:function(t){Promise.resolve().then(t)};class Ur extends Ce{constructor(){super(),this._listeners={},tt()&&addEventListener("storage",t=>{this.emit(t.key)})}addListener(t,n,r,i){if(this._listeners[n])return;var s=!1,u=this;function v(){if(!u._listeners[n])return;if(s){s="waiting";return}s=!0;var _=Je(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function y(){s=!1}r.changes(_).on("change",function(w){w.seq>i.since&&!i.cancelled&&(i.since=w.seq,i.onChange(w))}).on("complete",function(){s==="waiting"&&qe(v),s=!1}).on("error",y)}this._listeners[n]=v,this.on(t,v)}removeListener(t,n){n in this._listeners&&(super.removeListener(t,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(t){tt()&&(localStorage[t]=localStorage[t]==="a"?"b":"a")}notify(t){this.emit(t),this.notifyLocalWindows(t)}}function _e(e){if(typeof console<"u"&&typeof console[e]=="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function Gr(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t=t+1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function Jr(e){var t=0;return e||(t=2e3),Gr(e,t)}function Et(e,t){_e("info","The above "+e+" is totally normal. "+t)}class V extends Error{constructor(t,n,r){super(),this.status=t,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}}new V(401,"unauthorized","Name or password is incorrect.");var zr=new V(400,"bad_request","Missing JSON list of 'docs'"),he=new V(404,"not_found","missing"),Ne=new V(409,"conflict","Document update conflict"),zn=new V(400,"bad_request","_id field must contain a string"),Qr=new V(412,"missing_id","_id is required for puts"),Wr=new V(400,"bad_request","Only reserved document ids may start with underscore.");new V(412,"precondition_failed","Database not open");var zt=new V(500,"unknown_error","Database encountered an unknown error"),Qn=new V(500,"badarg","Some query argument is invalid");new V(400,"invalid_request","Request was invalid");var Hr=new V(400,"query_parse_error","Some query parameter is invalid"),ln=new V(500,"doc_validation","Bad special document member"),at=new V(400,"bad_request","Something wrong with the request"),ht=new V(400,"bad_request","Document must be a JSON object");new V(404,"not_found","Database not found");var Qt=new V(500,"indexed_db_went_bad","unknown");new V(500,"web_sql_went_bad","unknown");new V(500,"levelDB_went_went_bad","unknown");new V(403,"forbidden","Forbidden by design doc validate_doc_update function");var Ve=new V(400,"bad_request","Invalid rev format");new V(412,"file_exists","The database could not be created, the file already exists.");var Xr=new V(412,"missing_stub","A pre-existing attachment stub wasn't found");new V(413,"invalid_url","Provided URL is invalid");function G(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),s=0,u=i.length;s<u;s++)typeof e[i[s]]!="function"&&(this[i[s]]=e[i[s]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=V.prototype,new n(t)}function Ke(e){if(typeof e!="object"){var t=e;e=zt,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),"stack"in e||(e.stack=new Error().stack),e}function Yr(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return G(at,r)}}function Wt(e){var t={},n=e.filter&&typeof e.filter=="function";return t.query=e.query_params,function(i){i.doc||(i.doc={});var s=n&&Yr(e.filter,i.doc,t);if(typeof s=="object")return s;if(s)return!1;if(!e.include_docs)delete i.doc;else if(!e.attachments)for(var u in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,u)&&(i.doc._attachments[u].stub=!0);return!0}}function Wn(e){var t;if(e?typeof e!="string"?t=G(zn):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=G(Wr)):t=G(Qr),t)throw t}function Ae(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(_e("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function Zr(e,t){return"listenerCount"in e?e.listenerCount(t):Ce.listenerCount(e,t)}function kt(e){if(!e)return null;var t=e.split("/");return t.length===2?t:t.length===1?[e,e]:null}function dn(e){var t=kt(e);return t?t.join("/"):null}var hn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],vn="queryKey",Vr=/(?:^|&)([^&=]*)=?([^&]*)/g,ei=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Hn(e){for(var t=ei.exec(e),n={},r=14;r--;){var i=hn[r],s=t[r]||"",u=["user","password"].indexOf(i)!==-1;n[i]=u?decodeURIComponent(s):s}return n[vn]={},n[hn[12]].replace(Vr,function(v,_,y){_&&(n[vn][_]=y)}),n}function Ht(e,t){var n=[],r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function nt(e,t,n){return e.get(t).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,s=n(r);return s?(s._id=t,s._rev=i,ti(e,s,n)):{updated:!1,rev:i}})}function ti(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return nt(e,t._id,n)})}var Xt=function(e){return atob(e)},ze=function(e){return btoa(e)};function Yt(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(s){if(s.name!=="TypeError")throw s;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function ni(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function Zt(e,t){return Yt([ni(e)],{type:t})}function Vt(e,t){return Zt(Xt(e),t)}function ri(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function Xn(e,t){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var s=i.target.result||"";if(r)return t(s);t(ri(s))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function Yn(e,t){Xn(e,function(n){t(n)})}function en(e,t){Yn(e,function(n){t(ze(n))})}function ii(e,t){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}var si=self.setImmediate||self.setTimeout,ai=32768;function oi(e){return ze(e)}function ui(e,t,n,r,i){(n>0||r<t.size)&&(t=t.slice(n,r)),ii(t,function(s){e.append(s),i()})}function ci(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function tn(e,t){var n=typeof e=="string",r=n?e.length:e.size,i=Math.min(ai,r),s=Math.ceil(r/i),u=0,v=n?new Ct:new Ct.ArrayBuffer,_=n?ci:ui;function y(){si(l)}function w(){var g=v.end(!0),m=oi(g);t(m),v.destroy()}function l(){var g=u*i,m=g+i;u++,u<s?_(v,e,g,m,y):_(v,e,g,m,w)}l()}function Zn(e){return Ct.hash(e)}function Vn(e,t){if(!t)return Jt().replace(/-/g,"").toLowerCase();var n=Object.assign({},e);return delete n._rev_tree,Zn(JSON.stringify(n))}var ot=Jt;function Re(e){for(var t,n,r,i=e.rev_tree.slice(),s;s=i.pop();){var u=s.ids,v=u[2],_=s.pos;if(v.length){for(var y=0,w=v.length;y<w;y++)i.push({pos:_+1,ids:v[y]});continue}var l=!!u[1].deleted,g=u[0];(!t||(r!==l?r:n!==_?n<_:t<g))&&(t=g,n=_,r=l)}return n+"-"+t}function Le(e,t){for(var n=e.slice(),r;r=n.pop();)for(var i=r.pos,s=r.ids,u=s[2],v=t(u.length===0,i,s[0],r.ctx,s[1]),_=0,y=u.length;_<y;_++)n.push({pos:i+1,ids:u[_],ctx:v})}function fi(e,t){return e.pos-t.pos}function nn(e){var t=[];Le(e,function(i,s,u,v,_){i&&t.push({rev:s+"-"+u,pos:s,opts:_})}),t.sort(fi).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function rn(e){for(var t=Re(e),n=nn(e.rev_tree),r=[],i=0,s=n.length;i<s;i++){var u=n[i];u.rev!==t&&!u.opts.deleted&&r.push(u.rev)}return r}function li(e){var t=[];return Le(e.rev_tree,function(n,r,i,s,u){u.status==="available"&&!n&&(t.push(r+"-"+i),u.status="missing")}),t}function di(e,t){let n=[];const r=e.slice();let i;for(;i=r.pop();){const{pos:s,ids:u}=i,v=`${s}-${u[0]}`,_=u[2];if(n.push(v),v===t){if(_.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(_.length===0||_.length>1)&&(n=[]);for(let y=0,w=_.length;y<w;y++)r.push({pos:s+1,ids:_[y]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function er(e){for(var t=[],n=e.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,u=s[0],v=s[1],_=s[2],y=_.length===0,w=r.history?r.history.slice():[];w.push({id:u,opts:v}),y&&t.push({pos:i+1-w.length,ids:w});for(var l=0,g=_.length;l<g;l++)n.push({pos:i+1,ids:_[l],history:w})}return t.reverse()}function hi(e,t){return e.pos-t.pos}function vi(e,t,n){for(var r=0,i=e.length,s;r<i;)s=r+i>>>1,n(e[s],t)<0?r=s+1:i=s;return r}function _i(e,t,n){var r=vi(e,t,n);e.splice(r,0,t)}function _n(e,t){for(var n,r,i=t,s=e.length;i<s;i++){var u=e[i],v=[u.id,u.opts,[]];r?(r[2].push(v),r=v):n=r=v}return n}function gi(e,t){return e[0]<t[0]?-1:1}function gn(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),s=i.tree1,u=i.tree2;(s[1].status||u[1].status)&&(s[1].status=s[1].status==="available"||u[1].status==="available"?"available":"missing");for(var v=0;v<u[2].length;v++){if(!s[2][0]){r="new_leaf",s[2][0]=u[2][v];continue}for(var _=!1,y=0;y<s[2].length;y++)s[2][y][0]===u[2][v][0]&&(n.push({tree1:s[2][y],tree2:u[2][v]}),_=!0);_||(r="new_branch",_i(s[2],u[2][v],gi))}}return{conflicts:r,tree:e}}function tr(e,t,n){var r=[],i=!1,s=!1,u;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var v=0,_=e.length;v<_;v++){var y=e[v];if(y.pos===t.pos&&y.ids[0]===t.ids[0])u=gn(y.ids,t.ids),r.push({pos:y.pos,ids:u.tree}),i=i||u.conflicts,s=!0;else if(n!==!0){var w=y.pos<t.pos?y:t,l=y.pos<t.pos?t:y,g=l.pos-w.pos,m=[],S=[];for(S.push({ids:w.ids,diff:g,parent:null,parentIdx:null});S.length>0;){var O=S.pop();if(O.diff===0){O.ids[0]===l.ids[0]&&m.push(O);continue}for(var p=O.ids[2],h=0,d=p.length;h<d;h++)S.push({ids:p[h],diff:O.diff-1,parent:O.ids,parentIdx:h})}var o=m[0];o?(u=gn(o.ids,l.ids),o.parent[2][o.parentIdx]=u.tree,r.push({pos:w.pos,ids:w.ids}),i=i||u.conflicts,s=!0):r.push(y)}else r.push(y)}return s||r.push(t),r.sort(hi),{tree:r,conflicts:i||"internal_node"}}function yi(e,t){for(var n=er(e),r,i,s=0,u=n.length;s<u;s++){var v=n[s],_=v.ids,y;if(_.length>t){r||(r={});var w=_.length-t;y={pos:v.pos+w,ids:_n(_,w)};for(var l=0;l<w;l++){var g=v.pos+l+"-"+_[l].id;r[g]=!0}}else y={pos:v.pos,ids:_n(_,0)};i?i=tr(i,y,!0).tree:i=[y]}return r&&Le(i,function(m,S,O){delete r[S+"-"+O]}),{tree:i,revs:r?Object.keys(r):[]}}function nr(e,t,n){var r=tr(e,t),i=yi(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function pi(e,t){for(var n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),s=r[1],u;u=n.pop();){if(u.pos===i&&u.ids[0]===s)return!0;for(var v=u.ids[2],_=0,y=v.length;_<y;_++)n.push({pos:u.pos+1,ids:v[_]})}return!1}function mi(e){return e.ids}function Oe(e,t){t||(t=Re(e));for(var n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(mi),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Pe(e){return typeof e=="string"&&e.startsWith("_local/")}function wi(e,t){for(var n=t.rev_tree.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,u=s[0],v=s[1],_=s[2],y=_.length===0,w=r.history?r.history.slice():[];if(w.push({id:u,pos:i,opts:v}),y)for(var l=0,g=w.length;l<g;l++){var m=w[l],S=m.pos+"-"+m.id;if(S===e)return i+"-"+u}for(var O=0,p=_.length;O<p;O++)n.push({pos:i+1,ids:_[O],history:w})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function bi(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){_e("error",'Error in .on("change", function):',i)}}function Si(e,t,n){var r=[{rev:e._rev}];n.style==="all_docs"&&(r=nn(t.rev_tree).map(function(s){return{rev:s.rev}}));var i={id:t.id,changes:r,doc:e};return Oe(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=rn(t),i.doc._conflicts.length||delete i.doc._conflicts),i}class Ai extends Ce{constructor(t,n,r){super(),this.db=t,n=n?ae(n):{};var i=n.complete=Un((v,_)=>{v?Zr(this,"error")>0&&this.emit("error",v):this.emit("complete",_),this.removeAllListeners(),t.removeListener("destroyed",s)});r&&(this.on("complete",function(v){r(null,v)}),this.on("error",r));const s=()=>{this.cancel()};t.once("destroyed",s),n.onChange=(v,_,y)=>{this.isCancelled||bi(this,v,_,y)};var u=new Promise(function(v,_){n.complete=function(y,w){y?_(y):v(w)}});this.once("cancel",function(){t.removeListener("destroyed",s),n.complete(null,{status:"cancelled"})}),this.then=u.then.bind(u),this.catch=u.catch.bind(u),this.then(function(v){i(null,v)},i),t.taskqueue.isReady?this.validateChanges(n):t.taskqueue.addTask(v=>{v?n.complete(v):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(t){var n=t.complete;J._changesFilterPlugin?J._changesFilterPlugin.validate(t,r=>{if(r)return n(r);this.doChanges(t)}):this.doChanges(t)}doChanges(t){var n=t.complete;if(t=ae(t),"live"in t&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Si,t.since==="latest"&&(t.since="now"),t.since||(t.since=0),t.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}t.since=i.update_seq,this.doChanges(t)},n);return}if(J._changesFilterPlugin){if(J._changesFilterPlugin.normalize(t),J._changesFilterPlugin.shouldFilter(this,t))return J._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(i){i in t&&_e("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=t.limit===0?1:t.limit,t.complete=n;var r=this.db._changes(t);if(r&&typeof r.cancel=="function"){const i=this.cancel;this.cancel=(...s)=>{r.cancel(),i.apply(this,s)}}}}function vt(e,t){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=t,e(n)):e(null,r.length?r[0]:r)}}function qi(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var s=r[i];n._attachments[s]=Je(n._attachments[s],["data","digest","content_type","length","revpos","stub"])}}}function Oi(e,t){if(e._id===t._id){const n=e._revisions?e._revisions.start:0,r=t._revisions?t._revisions.start:0;return n-r}return e._id<t._id?-1:1}function Ci(e){var t={},n=[];return Le(e,function(r,i,s,u){var v=i+"-"+s;return r&&(t[v]=0),u!==void 0&&n.push({from:u,to:v}),v}),n.reverse(),n.forEach(function(r){t[r.from]===void 0?t[r.from]=1+t[r.to]:t[r.from]=Math.min(t[r.from],1+t[r.to])}),t}function xi(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function rr(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(s,u){s?r(s):r(null,u),qe(function(){e._compactionQueue.shift(),e._compactionQueue.length&&rr(e)})})})}function Ei(e,t,n){return e.get("_local/purges").then(function(r){const i=r.purgeSeq+1;return r.purges.push({docId:t,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:t,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return e.put(r)})}function ki(e){return e.charAt(0)==="_"?e+" is not a valid attachment name, attachment names cannot start with '_'":!1}function _t(e){return e===null||typeof e!="object"||Array.isArray(e)}const Di=/^\d+-[^-]*$/;function gt(e){return typeof e=="string"&&Di.test(e)}class ir extends Ce{_setup(){this.post=te("post",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),_t(t))return r(G(ht));this.bulkDocs({docs:[t]},n,vt(r,t._id))}).bind(this),this.put=te("put",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),_t(t))return r(G(ht));if(Wn(t._id),"_rev"in t&&!gt(t._rev))return r(G(Ve));if(Pe(t._id)&&typeof this._putLocal=="function")return t._deleted?this._removeLocal(t,r):this._putLocal(t,r);const i=u=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(t,n,u):this.bulkDocs({docs:[t]},n,vt(u,t._id))};n.force&&t._rev?(s(),i(function(u){var v=u?null:{ok:!0,id:t._id,rev:t._rev};r(u,v)})):i(r);function s(){var u=t._rev.split("-"),v=u[1],_=parseInt(u[0],10),y=_+1,w=Vn();t._revisions={start:y,ids:[w,v]},t._rev=y+"-"+w,n.new_edits=!1}}).bind(this),this.putAttachment=te("putAttachment",function(t,n,r,i,s){var u=this;typeof s=="function"&&(s=i,i=r,r=null),typeof s>"u"&&(s=i,i=r,r=null),s||_e("warn","Attachment",n,"on document",t,"is missing content_type");function v(_){var y="_rev"in _?parseInt(_._rev,10):0;return _._attachments=_._attachments||{},_._attachments[n]={content_type:s,data:i,revpos:++y},u.put(_)}return u.get(t).then(function(_){if(_._rev!==r)throw G(Ne);return v(_)},function(_){if(_.reason===he.message)return v({_id:t});throw _})}).bind(this),this.removeAttachment=te("removeAttachment",function(t,n,r,i){this.get(t,(s,u)=>{if(s){i(s);return}if(u._rev!==r){i(G(Ne));return}if(!u._attachments)return i();delete u._attachments[n],Object.keys(u._attachments).length===0&&delete u._attachments,this.put(u,i)})}).bind(this),this.remove=te("remove",function(t,n,r,i){var s;typeof n=="string"?(s={_id:t,_rev:n},typeof r=="function"&&(i=r,r={})):(s=t,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var u={_id:s._id,_rev:s._rev||r.rev};if(u._deleted=!0,Pe(u._id)&&typeof this._removeLocal=="function")return this._removeLocal(s,i);this.bulkDocs({docs:[u]},r,vt(i,u._id))}).bind(this),this.revsDiff=te("revsDiff",function(t,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(t);if(!i.length)return r(null,{});var s=0,u=new Map;function v(y,w){u.has(y)||u.set(y,{missing:[]}),u.get(y).missing.push(w)}function _(y,w){var l=t[y].slice(0);Le(w,function(g,m,S,O,p){var h=m+"-"+S,d=l.indexOf(h);d!==-1&&(l.splice(d,1),p.status!=="available"&&v(y,h))}),l.forEach(function(g){v(y,g)})}i.forEach(function(y){this._getRevisionTree(y,function(w,l){if(w&&w.status===404&&w.message==="missing")u.set(y,{missing:t[y]});else{if(w)return r(w);_(y,l)}if(++s===i.length){var g={};return u.forEach(function(m,S){g[S]=m}),r(null,g)}})},this)}).bind(this),this.bulkGet=te("bulkGet",function(t,n){Jn(this,t,n)}).bind(this),this.compactDocument=te("compactDocument",function(t,n,r){this._getRevisionTree(t,(i,s)=>{if(i)return r(i);var u=Ci(s),v=[],_=[];Object.keys(u).forEach(function(y){u[y]>n&&v.push(y)}),Le(s,function(y,w,l,g,m){var S=w+"-"+l;m.status==="available"&&v.indexOf(S)!==-1&&_.push(S)}),this._doCompaction(t,_,r)})}).bind(this),this.compact=te("compact",function(t,n){typeof t=="function"&&(n=t,t={}),t=t||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:t,callback:n}),this._compactionQueue.length===1&&rr(this)}).bind(this),this.get=te("get",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},typeof t!="string")return r(G(zn));if(Pe(t)&&typeof this._getLocal=="function")return this._getLocal(t,r);var i=[];const s=()=>{var _=[],y=i.length;if(!y)return r(null,_);i.forEach(w=>{this.get(t,{rev:w,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(l,g){if(l)_.push({missing:w});else{for(var m,S=0,O=_.length;S<O;S++)if(_[S].ok&&_[S].ok._rev===g._rev){m=!0;break}m||_.push({ok:g})}y--,y||r(null,_)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(t,function(_,y){if(_)return r(_);i=nn(y).map(function(w){return w.rev}),s()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var u=0;u<i.length;u++){var v=i[u];if(!gt(v))return r(G(Ve))}s()}else return r(G(zt,"function_clause"));return}return this._get(t,n,(_,y)=>{if(_)return _.docId=t,r(_);var w=y.doc,l=y.metadata,g=y.ctx;if(n.conflicts){var m=rn(l);m.length&&(w._conflicts=m)}if(Oe(l,w._rev)&&(w._deleted=!0),n.revs||n.revs_info){for(var S=w._rev.split("-"),O=parseInt(S[0],10),p=S[1],h=er(l.rev_tree),d=null,o=0;o<h.length;o++){var a=h[o];const j=a.ids.findIndex(N=>N.id===p);var c=j===O-1;(c||!d&&j!==-1)&&(d=a)}if(!d)return _=new Error("invalid rev tree"),_.docId=t,r(_);const B=w._rev.split("-")[1],F=d.ids.findIndex(j=>j.id===B)+1;var f=d.ids.length-F;if(d.ids.splice(F,f),d.ids.reverse(),n.revs&&(w._revisions={start:d.pos+d.ids.length-1,ids:d.ids.map(function(j){return j.id})}),n.revs_info){var q=d.pos+d.ids.length;w._revs_info=d.ids.map(function(j){return q--,{rev:q+"-"+j.id,status:j.opts.status}})}}if(n.attachments&&w._attachments){var C=w._attachments,E=Object.keys(C).length;if(E===0)return r(null,w);Object.keys(C).forEach(B=>{this._getAttachment(w._id,B,C[B],{binary:n.binary,metadata:l,ctx:g},function(F,j){var N=w._attachments[B];N.data=j,delete N.stub,delete N.length,--E||r(null,w)})})}else{if(w._attachments)for(var P in w._attachments)Object.prototype.hasOwnProperty.call(w._attachments,P)&&(w._attachments[P].stub=!0);r(null,w)}})}).bind(this),this.getAttachment=te("getAttachment",function(t,n,r,i){r instanceof Function&&(i=r,r={}),this._get(t,r,(s,u)=>{if(s)return i(s);if(u.doc._attachments&&u.doc._attachments[n])r.ctx=u.ctx,r.binary=!0,r.metadata=u.metadata,this._getAttachment(t,n,u.doc._attachments[n],r,i);else return i(G(he))})}).bind(this),this.allDocs=te("allDocs",function(t,n){if(typeof t=="function"&&(n=t,t={}),t.skip=typeof t.skip<"u"?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in t})[0];if(r){n(G(Hr,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!Ae(this)&&(xi(t),t.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(t,n)}).bind(this),this.close=te("close",function(t){return this._closed=!0,this.emit("closed"),this._close(t)}).bind(this),this.info=te("info",function(t){this._info((n,r)=>{if(n)return t(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!Ae(this)),r.adapter=this.adapter,t(null,r)})}).bind(this),this.id=te("id",function(t){return this._id(t)}).bind(this),this.bulkDocs=te("bulkDocs",function(t,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(t)&&(t={docs:t}),!t||!t.docs||!Array.isArray(t.docs))return r(G(zr));for(var i=0;i<t.docs.length;++i){const _=t.docs[i];if(_t(_))return r(G(ht));if("_rev"in _&&!gt(_._rev))return r(G(Ve))}var s;if(t.docs.forEach(function(_){_._attachments&&Object.keys(_._attachments).forEach(function(y){s=s||ki(y),_._attachments[y].content_type||_e("warn","Attachment",y,"on document",_._id,"is missing content_type")})}),s)return r(G(at,s));"new_edits"in n||("new_edits"in t?n.new_edits=t.new_edits:n.new_edits=!0);var u=this;!n.new_edits&&!Ae(u)&&t.docs.sort(Oi),qi(t.docs);var v=t.docs.map(function(_){return _._id});this._bulkDocs(t,n,function(_,y){if(_)return r(_);if(n.new_edits||(y=y.filter(function(g){return g.error})),!Ae(u))for(var w=0,l=y.length;w<l;w++)y[w].id=y[w].id||v[w];r(null,y)})}).bind(this),this.registerDependentDatabase=te("registerDependentDatabase",function(t,n){var r=ae(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(t,r);function s(u){return u.dependentDbs=u.dependentDbs||{},u.dependentDbs[t]?!1:(u.dependentDbs[t]=!0,u)}nt(this,"_local/_pouch_dependentDbs",s).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=te("destroy",function(t,n){typeof t=="function"&&(n=t,t={});var r="use_prefix"in this?this.use_prefix:!0;const i=()=>{this._destroy(t,(s,u)=>{if(s)return n(s);this._destroyed=!0,this.emit("destroyed"),n(null,u||{ok:!0})})};if(Ae(this))return i();this.get("_local/_pouch_dependentDbs",(s,u)=>{if(s)return s.status!==404?n(s):i();var v=u.dependentDbs,_=this.constructor,y=Object.keys(v).map(w=>{var l=r?w.replace(new RegExp("^"+_.prefix),""):w;return new _(l,this.__opts).destroy()});Promise.all(y).then(i,n)})}).bind(this)}_compact(t,n){var r={return_docs:!1,last_seq:t.last_seq||0,since:t.last_seq||0},i=[],s,u=0;const v=w=>{this.activeTasks.update(s,{completed_items:++u}),i.push(this.compactDocument(w.id,0))},_=w=>{this.activeTasks.remove(s,w),n(w)},y=w=>{var l=w.last_seq;Promise.all(i).then(()=>nt(this,"_local/compaction",g=>!g.last_seq||g.last_seq<l?(g.last_seq=l,g):!1)).then(()=>{this.activeTasks.remove(s),n(null,{ok:!0})}).catch(_)};this.info().then(w=>{s=this.activeTasks.add({name:"database_compaction",total_items:w.update_seq-r.last_seq}),this.changes(r).on("change",v).on("complete",y).on("error",_)})}changes(t,n){return typeof t=="function"&&(n=t,t={}),t=t||{},t.return_docs="return_docs"in t?t.return_docs:!t.live,new Ai(this,t,n)}type(){return typeof this._type=="function"?this._type():this.adapter}}ir.prototype.purge=te("_purge",function(e,t,n){if(typeof this._purge>"u")return n(G(zt,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(e,(i,s)=>{if(i)return n(i);if(!s)return n(G(he));let u;try{u=di(s,t)}catch(v){return n(v.message||v)}r._purge(e,u,(v,_)=>{if(v)return n(v);Ei(r,e,t).then(function(){return n(null,_)})})})});class Ti{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var t;if(this.failed)for(;t=this.queue.shift();)t(this.failed);else for(;t=this.queue.shift();)t()}fail(t){this.failed=t,this.execute()}ready(t){this.isReady=!0,this.db=t,this.execute()}addTask(t){this.queue.push(t),this.failed&&this.execute()}}function Pi(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=J.adapters,i=J.preferredAdapters,s=J.prefix,u=t.adapter;if(!u)for(var v=0;v<i.length;++v){if(u=i[v],u==="idb"&&"websql"in r&&tt()&&localStorage["_pouch__websqldb_"+s+e]){_e("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var _=r[u],y=_&&"use_prefix"in _?_.use_prefix:!0;return{name:y?s+e:e,adapter:u}}function Ri(e,t){e.prototype=Object.create(t.prototype,{constructor:{value:e}})}function sr(e,t){let n=function(...r){if(!(this instanceof n))return new n(...r);t.apply(this,r)};return Ri(n,e),n}function Li(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}class yn extends ir{constructor(t,n){super(),this._setup(t,n)}_setup(t,n){if(super._setup(),n=n||{},t&&typeof t=="object"&&(n=t,t=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=ae(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=J.prefix,typeof t!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+t,i=Pi(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=t,this._adapter=n.adapter,J.emit("debug",["adapter","Picked adapter: ",n.adapter]),!J.adapters[n.adapter]||!J.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!J.adapters[n.view_adapter]||!J.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new Ti,this.adapter=n.adapter,J.adapters[n.adapter].call(this,n,s=>{if(s)return this.taskqueue.fail(s);Li(this),this.emit("created",this),J.emit("created",this.name),this.taskqueue.ready(this)})}}const J=sr(yn,function(e,t){yn.prototype._setup.call(this,e,t)});var ar=fetch,je=Headers;class Bi{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(t){const n=Jt();return this.tasks[n]={id:n,name:t.name,total_items:t.total_items,created_at:new Date().toJSON()},n}get(t){return this.tasks[t]}remove(t,n){return delete this.tasks[t],this.tasks}update(t,n){const r=this.tasks[t];if(typeof r<"u"){const i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[t]=i}return this.tasks}}J.adapters={};J.preferredAdapters=[];J.prefix="_pouch_";var pn=new Ce;function Ii(e){Object.keys(Ce.prototype).forEach(function(n){typeof Ce.prototype[n]=="function"&&(e[n]=pn[n].bind(pn))});var t=e._destructionListeners=new Map;e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(t.has(r.name)){var i=t.get(r.name),s=i.indexOf(r);s<0||(i.splice(s,1),i.length>1?t.set(r.name,i):t.delete(r.name))}}),e.on("destroyed",function(r){if(t.has(r)){var i=t.get(r);t.delete(r),i.forEach(function(s){s.emit("destroyed",!0)})}})}Ii(J);J.adapter=function(e,t,n){t.valid()&&(J.adapters[e]=t,n&&J.preferredAdapters.push(e))};J.plugin=function(e){if(typeof e=="function")e(J);else{if(typeof e!="object"||Object.keys(e).length===0)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){J.prototype[t]=e[t]})}return this.__defaults&&(J.__defaults=Object.assign({},this.__defaults)),J};J.defaults=function(e){let t=sr(J,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Object.assign({},t.__defaults,r),J.call(this,n,r)});return t.preferredAdapters=J.preferredAdapters.slice(),Object.keys(J).forEach(function(n){n in t||(t[n]=J[n])}),t.__defaults=Object.assign({},this.__defaults,e),t};J.fetch=function(e,t){return ar(e,t)};J.prototype.activeTasks=J.activeTasks=new Bi;var ji="9.0.0";function sn(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var s=t[r];if(n=n[s],!n)break}return n}function $i(e,t){return e<t?-1:e>t?1:0}function an(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var s=e[r];r>0&&e[r-1]==="\\"&&(s==="$"||s===".")?n=n.substring(0,n.length-1)+s:s==="."?(t.push(n),n=""):n+=s}return t.push(n),t}var Ni=["$or","$nor","$not"];function or(e){return Ni.indexOf(e)>-1}function ur(e){return Object.keys(e)[0]}function Ki(e){return e[ur(e)]}function Ge(e){var t={},n={$or:!0,$nor:!0};return e.forEach(function(r){Object.keys(r).forEach(function(i){var s=r[i];if(typeof s!="object"&&(s={$eq:s}),or(i))if(s instanceof Array){if(n[i]){n[i]=!1,t[i]=s;return}var u=[];t[i].forEach(function(_){Object.keys(s).forEach(function(y){var w=s[y],l=Math.max(Object.keys(_).length,Object.keys(w).length),g=Ge([_,w]);Object.keys(g).length<=l||u.push(g)})}),t[i]=u}else t[i]=Ge([s]);else{var v=t[i]=t[i]||{};Object.keys(s).forEach(function(_){var y=s[_];if(_==="$gt"||_==="$gte")return Mi(_,y,v);if(_==="$lt"||_==="$lte")return Fi(_,y,v);if(_==="$ne")return Ui(y,v);if(_==="$eq")return Gi(y,v);if(_==="$regex")return Ji(y,v);v[_]=y})}})}),t}function Mi(e,t,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt<"u"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t)}function Fi(e,t,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt<"u"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t)}function Ui(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function Gi(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Ji(e,t){"$regex"in t?t.$regex.push(e):t.$regex=[e]}function cr(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=Ge(e[n].$and));var r=e[t];typeof r=="object"&&cr(r)}return e}function fr(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=fr(r,t))}return t}function zi(e){var t=ae(e);fr(t,!1)&&(t=cr(t),"$and"in t&&(t=Ge(t.$and))),["$or","$nor"].forEach(function(u){u in t&&t[u].forEach(function(v){for(var _=Object.keys(v),y=0;y<_.length;y++){var w=_[y],l=v[w];(typeof l!="object"||l===null)&&(v[w]={$eq:l})}})}),"$not"in t&&(t.$not=Ge([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],s=t[i];(typeof s!="object"||s===null)&&(s={$eq:s}),t[i]=s}return Dt(t),t}function Dt(e){Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&Dt(r)}):t==="$ne"?e.$ne=[n]:t==="$regex"?e.$regex=[n]:n&&typeof n=="object"&&Dt(n)})}function Qi(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Wi(e,t,n){var r=Qi(e,t,n);return r+e}var lr=-324,Tt=3,Pt="";function ne(e,t){if(e===t)return 0;e=Be(e),t=Be(t);var n=Rt(e),r=Rt(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return es(e,t)}return Array.isArray(e)?Vi(e,t):ts(e,t)}function Be(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=Be(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var s=t[i];typeof s<"u"&&(e[i]=Be(s))}}}}return e}function Hi(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return ns(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,s="";if(t)for(;++r<i;)s+=pe(n[r]);else for(;++r<i;){var u=n[r];s+=pe(u)+pe(e[u])}return s}return""}function pe(e){var t="\0";return e=Be(e),Rt(e)+Pt+Hi(e)+t}function Xi(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var s=e[t]==="0";t++;var u="",v=e.substring(t,t+Tt),_=parseInt(v,10)+lr;for(s&&(_=-_),t+=Tt;;){var y=e[t];if(y==="\0")break;u+=y,t++}u=u.split("."),u.length===1?r=parseInt(u,10):r=parseFloat(u[0]+"."+u[1]),s&&(r=r-10),_!==0&&(r=parseFloat(r+"e"+_))}return{num:r,length:t-n}}function Yi(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(n);else if(s===e.length-2){var u=e.pop();i[u]=n}else e.push(n)}}function Zi(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();Yi(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var s=Xi(e,r);t.push(s.num),r+=s.length;break;case"4":for(var u="";;){var v=e[r];if(v==="\0")break;u+=v,r++}u=u.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(u);break;case"5":var _={element:[],index:t.length};t.push(_.element),n.push(_);break;case"6":var y={element:{},index:t.length};t.push(y.element),n.push(y);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function Vi(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=ne(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function es(e,t){return e===t?0:e>t?1:-1}function ts(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),s=0;s<i;s++){var u=ne(n[s],r[s]);if(u!==0||(u=ne(e[n[s]],t[r[s]]),u!==0))return u}return n.length===r.length?0:n.length>r.length?1:-1}function Rt(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function ns(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",s=(r?-n:n)-lr,u=Wi(s.toString(),"0",Tt);i+=Pt+u;var v=Math.abs(parseFloat(t[0]));r&&(v=10-v);var _=v.toFixed(20);return _=_.replace(/\.?0+$/,""),i+=Pt+_,i}function rs(e){function t(n){return e.map(function(r){var i=ur(r),s=an(i),u=sn(n,s);return u})}return function(n,r){var i=t(n.doc),s=t(r.doc),u=ne(i,s);return u!==0?u:$i(n.doc._id,r.doc._id)}}function is(e,t,n){if(e=e.filter(function(u){return $e(u.doc,t.selector,n)}),t.sort){var r=rs(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&Ki(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,s=("limit"in t?t.limit:e.length)+i;e=e.slice(i,s)}return e}function $e(e,t,n){return n.every(function(r){var i=t[r],s=an(r),u=sn(e,s);return or(r)?ss(r,i,e):rt(i,e,s,u)})}function rt(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var s=e[i];if(i.indexOf("$")===0)return mn(i,t,s,n,r);var u=an(i);if(r===void 0&&typeof s!="object"&&u.length>0)return!1;var v=sn(r,u);return typeof s=="object"?rt(s,t,n,v):mn("$eq",t,s,u,v)}):e===r:!0}function ss(e,t,n){return e==="$or"?t.some(function(r){return $e(n,r,Object.keys(r))}):e==="$not"?!$e(n,t,Object.keys(t)):!t.find(function(r){return $e(n,r,Object.keys(r))})}function mn(e,t,n,r,i){if(!bn[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return bn[e](t,n,r,i)}function Fe(e){return typeof e<"u"&&e!==null}function xe(e){return typeof e<"u"}function as(e,t){if(typeof e!="number"||parseInt(e,10)!==e)return!1;var n=t[0],r=t[1];return e%n===r}function wn(e,t){return t.some(function(n){return e instanceof Array?e.some(function(r){return ne(n,r)===0}):ne(n,e)===0})}function os(e,t){return t.every(function(n){return e.some(function(r){return ne(n,r)===0})})}function us(e,t){return e.length===t}function cs(e,t){var n=new RegExp(t);return n.test(e)}function fs(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}}var bn={$elemMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return $e(i,t,Object.keys(t))}):r.some(function(i){return rt(t,e,n,i)})},$allMatch:function(e,t,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return $e(i,t,Object.keys(t))}):r.every(function(i){return rt(t,e,n,i)})},$eq:function(e,t,n,r){return xe(r)&&ne(r,t)===0},$gte:function(e,t,n,r){return xe(r)&&ne(r,t)>=0},$gt:function(e,t,n,r){return xe(r)&&ne(r,t)>0},$lte:function(e,t,n,r){return xe(r)&&ne(r,t)<=0},$lt:function(e,t,n,r){return xe(r)&&ne(r,t)<0},$exists:function(e,t,n,r){return t?xe(r):!xe(r)},$mod:function(e,t,n,r){return Fe(r)&&as(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return ne(r,i)!==0})},$in:function(e,t,n,r){return Fe(r)&&wn(r,t)},$nin:function(e,t,n,r){return Fe(r)&&!wn(r,t)},$size:function(e,t,n,r){return Fe(r)&&Array.isArray(r)&&us(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&os(r,t)},$regex:function(e,t,n,r){return Fe(r)&&typeof r=="string"&&t.every(function(i){return cs(r,i)})},$type:function(e,t,n,r){return fs(r,t)}};function ls(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=zi(t);var n={doc:e},r=is([n],{selector:t},Object.keys(t));return r&&r.length===1}function ds(e){return Ht(`"use strict";
return `+e+";",{})}function hs(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Ht(t,{})}function vs(e,t){if(e.selector&&e.filter&&e.filter!=="_selector"){var n=typeof e.filter=="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function _s(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&typeof e.filter=="string"&&(e.filter==="_view"?e.view=dn(e.view):e.filter=dn(e.filter))}function gs(e,t){return t.filter&&typeof t.filter=="string"&&!t.doc_ids&&!Ae(e.db)}function ys(e,t){var n=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!="string"){var r=G(at,"`view` filter parameter not found or invalid.");return n(r)}var i=kt(t.view);e.db.get("_design/"+i[0],function(u,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(u)return n(Ke(u));var _=v&&v.views&&v.views[i[1]]&&v.views[i[1]].map;if(!_)return n(G(he,v.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=hs(_),e.doChanges(t)})}else if(t.selector)t.filter=function(u){return ls(u,t.selector)},e.doChanges(t);else{var s=kt(t.filter);e.db.get("_design/"+s[0],function(u,v){if(e.isCancelled)return n(null,{status:"cancelled"});if(u)return n(Ke(u));var _=v&&v.filters&&v.filters[s[1]];if(!_)return n(G(he,v&&v.filters?"missing json key: "+s[1]:"missing json key: filters"));t.filter=ds(_),e.doChanges(t)})}}function ps(e){e._changesFilterPlugin={validate:vs,normalize:_s,shouldFilter:gs,filter:ys}}J.plugin(ps);J.version=ji;function ms(e,t,n){return new Promise(function(r){var i=Yt([""]);let s;{const u=n;s=e.objectStore(t).put(i,u)}s.onsuccess=function(){var u=navigator.userAgent.match(/Chrome\/(\d+)/),v=navigator.userAgent.match(/Edge\//);r(v||!u||parseInt(u[1],10)>=43)},s.onerror=e.onabort=function(u){u.preventDefault(),u.stopPropagation(),r(!1)}}).catch(function(){return!1})}function dr(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}var ws=dr(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),bs=dr(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Sn(e){if(!/^\d+-/.test(e))return G(Ve);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function Ss(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],s=1,u=r.length;s<u;s++)i=[r[s],{status:"missing"},[i]];return[{pos:n,ids:i}]}function hr(e,t,n){n||(n={deterministic_revs:!0});var r,i,s,u={status:"available"};if(e._deleted&&(u.deleted=!0),t)if(e._id||(e._id=ot()),i=Vn(e,n.deterministic_revs),e._rev){if(s=Sn(e._rev),s.error)return s;e._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[i,u,[]]]]}],r=s.prefix+1}else e._rev_tree=[{pos:1,ids:[i,u,[]]}],r=1;else if(e._revisions&&(e._rev_tree=Ss(e._revisions,u),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(s=Sn(e._rev),s.error)return s;r=s.prefix,i=s.id,e._rev_tree=[{pos:r,ids:[i,u,[]]}]}Wn(e._id),e._rev=r+"-"+i;var v={metadata:{},data:{}};for(var _ in e)if(Object.prototype.hasOwnProperty.call(e,_)){var y=_[0]==="_";if(y&&!ws[_]){var w=G(ln,_);throw w.message=ln.message+": "+_,w}else y&&!bs[_]?v.metadata[_.slice(1)]=e[_]:v.data[_]=e[_]}return v}function As(e){try{return Xt(e)}catch{var t=G(Qn,"Attachment is not a valid base64 string");return{error:t}}}function qs(e,t,n){var r=As(e.data);if(r.error)return n(r.error);e.length=r.length,t==="blob"?e.data=Zt(r,e.content_type):t==="base64"?e.data=ze(r):e.data=r,tn(r,function(i){e.digest="md5-"+i,n()})}function Os(e,t,n){tn(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,t==="binary"?Yn(e.data,function(i){e.data=i,n()}):t==="base64"?en(e.data,function(i){e.data=i,n()}):n()})}function Cs(e,t,n){if(e.stub)return n();typeof e.data=="string"?qs(e,t,n):Os(e,t,n)}function xs(e,t,n){if(!e.length)return n();var r=0,i;e.forEach(function(u){var v=u.data&&u.data._attachments?Object.keys(u.data._attachments):[],_=0;if(!v.length)return s();function y(l){i=l,_++,_===v.length&&s()}for(var w in u.data._attachments)Object.prototype.hasOwnProperty.call(u.data._attachments,w)&&Cs(u.data._attachments[w],t,y)});function s(){r++,e.length===r&&(i?n(i):n())}}function Es(e,t,n,r,i,s,u,v){if(pi(t.rev_tree,n.metadata.rev)&&!v)return r[i]=n,s();var _=t.winningRev||Re(t),y="deleted"in t?t.deleted:Oe(t,_),w="deleted"in n.metadata?n.metadata.deleted:Oe(n.metadata),l=/^1-/.test(n.metadata.rev);if(y&&!w&&v&&l){var g=n.data;g._rev=_,g._id=n.metadata.id,n=hr(g,v)}var m=nr(t.rev_tree,n.metadata.rev_tree[0],e),S=v&&(y&&w&&m.conflicts!=="new_leaf"||!y&&m.conflicts!=="new_leaf"||y&&!w&&m.conflicts==="new_branch");if(S){var O=G(Ne);return r[i]=O,s()}var p=n.metadata.rev;n.metadata.rev_tree=m.tree,n.stemmedRevs=m.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var h=Re(n.metadata),d=Oe(n.metadata,h),o=y===d?0:y<d?-1:1,a;p===h?a=d:a=Oe(n.metadata,p),u(n,h,d,a,!0,o,i,s)}function ks(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function Ds(e,t,n,r,i,s,u,v,_){e=e||1e3;function y(O,p,h){var d=Re(O.metadata),o=Oe(O.metadata,d);if("was_delete"in v&&o)return s[p]=G(he,"deleted"),h();var a=w&&ks(O);if(a){var c=G(Ne);return s[p]=c,h()}var f=o?0:1;u(O,d,o,o,!1,f,p,h)}var w=v.new_edits,l=new Map,g=0,m=t.length;function S(){++g===m&&_&&_()}t.forEach(function(O,p){if(O._id&&Pe(O._id)){var h=O._deleted?"_removeLocal":"_putLocal";n[h](O,{ctx:i},function(o,a){s[p]=o||a,S()});return}var d=O.metadata.id;l.has(d)?(m--,l.get(d).push([O,p])):l.set(d,[[O,p]])}),l.forEach(function(O,p){var h=0;function d(){++h<O.length?o():S()}function o(){var a=O[h],c=a[0],f=a[1];if(r.has(p))Es(e,r.get(p),c,s,f,d,u,w);else{var q=nr([],c.metadata.rev_tree[0],e);c.metadata.rev_tree=q.tree,c.stemmedRevs=q.stemmedRevs||[],y(c,f,d)}}o()})}var Ts=5,ie="document-store",ce="by-sequence",ve="attach-store",De="attach-seq-store",fe="meta-store",be="local-store",yt="detect-blob-support";function Ps(e){try{return JSON.parse(e)}catch{return Mn.parse(e)}}function Rs(e){try{return JSON.stringify(e)}catch{return Mn.stringify(e)}}function Se(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(G(Qt,n,t.type))}}function Lt(e,t,n){return{data:Rs(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Te(e){if(!e)return null;var t=Ps(e.data);return t.winningRev=e.winningRev,t.deleted=e.deletedOrLocal==="1",t.seq=e.seq,t}function it(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function vr(e,t,n,r){n?r(e?typeof e!="string"?e:Vt(e,t):Yt([""],{type:t})):e?typeof e!="string"?Xn(e,function(i){r(ze(i))}):r(e):r("")}function _r(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var s=0;function u(){++s===i.length&&r&&r()}function v(_,y){var w=_._attachments[y],l=w.digest,g=n.objectStore(ve).get(l);g.onsuccess=function(m){w.body=m.target.result.body,u()}}i.forEach(function(_){t.attachments&&t.include_docs?v(e,_):(e._attachments[_].stub=!0,u())})}function Bt(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var s=n.doc._attachments[i];if("body"in s){var u=s.body,v=s.content_type;return new Promise(function(_){vr(u,v,t,function(y){n.doc._attachments[i]=Object.assign(Je(s,["digest","content_type"]),{data:y}),_()})})}}))}}))}function gr(e,t,n){var r=[],i=n.objectStore(ce),s=n.objectStore(ve),u=n.objectStore(De),v=e.length;function _(){v--,v||y()}function y(){r.length&&r.forEach(function(w){var l=u.index("digestSeq").count(IDBKeyRange.bound(w+"::",w+"::￿",!1,!1));l.onsuccess=function(g){var m=g.target.result;m||s.delete(w)}})}e.forEach(function(w){var l=i.index("_doc_id_rev"),g=t+"::"+w;l.getKey(g).onsuccess=function(m){var S=m.target.result;if(typeof S!="number")return _();i.delete(S);var O=u.index("seq").openCursor(IDBKeyRange.only(S));O.onsuccess=function(p){var h=p.target.result;if(h){var d=h.value.digestSeq.split("::")[0];r.push(d),u.delete(h.primaryKey),h.continue()}else _()}}})}function me(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var Ue=new Ur;function Ls(e,t,n,r,i,s){for(var u=t.docs,v,_,y,w,l,g,m,S,O=0,p=u.length;O<p;O++){var h=u[O];h._id&&Pe(h._id)||(h=u[O]=hr(h,n.new_edits,e),h.error&&!m&&(m=h))}if(m)return s(m);var d=!1,o=0,a=new Array(u.length),c=new Map,f=!1,q=r._meta.blobSupport?"blob":"base64";xs(u,q,function(k){if(k)return s(k);C()});function C(){var k=[ie,ce,ve,be,De,fe],R=me(i,k,"readwrite");if(R.error)return s(R.error);v=R.txn,v.onabort=Se(s),v.ontimeout=Se(s),v.oncomplete=j,_=v.objectStore(ie),y=v.objectStore(ce),w=v.objectStore(ve),l=v.objectStore(De),g=v.objectStore(fe),g.get(fe).onsuccess=function($){S=$.target.result,B()},z(function($){if($)return f=!0,s($);F()})}function E(){d=!0,B()}function P(){Ds(e.revs_limit,u,r,c,v,a,Q,n,E)}function B(){!S||!d||(S.docCount+=o,g.put(S))}function F(){if(!u.length)return;var k=0;function R(){++k===u.length&&P()}function $(I){var K=Te(I.target.result);K&&c.set(K.id,K),R()}for(var U=0,L=u.length;U<L;U++){var x=u[U];if(x._id&&Pe(x._id)){R();continue}var D=_.get(x.metadata.id);D.onsuccess=$}}function j(){f||(Ue.notify(r._meta.name),s(null,a))}function N(k,R){var $=w.get(k);$.onsuccess=function(U){if(U.target.result)R();else{var L=G(Xr,"unknown stub attachment with digest "+k);L.status=412,R(L)}}}function z(k){var R=[];if(u.forEach(function(x){x.data&&x.data._attachments&&Object.keys(x.data._attachments).forEach(function(D){var I=x.data._attachments[D];I.stub&&R.push(I.digest)})}),!R.length)return k();var $=0,U;function L(){++$===R.length&&k(U)}R.forEach(function(x){N(x,function(D){D&&!U&&(U=D),L()})})}function Q(k,R,$,U,L,x,D,I){k.metadata.winningRev=R,k.metadata.deleted=$;var K=k.data;K._id=k.metadata.id,K._rev=k.metadata.rev,U&&(K._deleted=!0);var M=K._attachments&&Object.keys(K._attachments).length;if(M)return b(k,R,$,L,D,I);o+=x,B(),W(k,R,$,L,D,I)}function W(k,R,$,U,L,x){var D=k.data,I=k.metadata;D._doc_id_rev=I.id+"::"+I.rev,delete D._id,delete D._rev;function K(re){var le=k.stemmedRevs||[];U&&r.auto_compaction&&(le=le.concat(li(k.metadata))),le&&le.length&&gr(le,k.metadata.id,v),I.seq=re.target.result;var we=Lt(I,R,$),X=_.put(we);X.onsuccess=Y}function M(re){re.preventDefault(),re.stopPropagation();var le=y.index("_doc_id_rev"),we=le.getKey(D._doc_id_rev);we.onsuccess=function(X){var H=y.put(D,X.target.result);H.onsuccess=K}}function Y(){a[L]={ok:!0,id:I.id,rev:I.rev},c.set(k.metadata.id,k.metadata),A(k,I.seq,x)}var ee=y.put(D);ee.onsuccess=K,ee.onerror=M}function b(k,R,$,U,L,x){var D=k.data,I=0,K=Object.keys(D._attachments);function M(){I===K.length&&W(k,R,$,U,L,x)}function Y(){I++,M()}K.forEach(function(ee){var re=k.data._attachments[ee];if(re.stub)I++,M();else{var le=re.data;delete re.data,re.revpos=parseInt(R,10);var we=re.digest;T(we,le,Y)}})}function A(k,R,$){var U=0,L=Object.keys(k.data._attachments||{});if(!L.length)return $();function x(){++U===L.length&&$()}function D(K){var M=k.data._attachments[K].digest,Y=l.put({seq:R,digestSeq:M+"::"+R});Y.onsuccess=x,Y.onerror=function(ee){ee.preventDefault(),ee.stopPropagation(),x()}}for(var I=0;I<L.length;I++)D(L[I])}function T(k,R,$){var U=w.count(k);U.onsuccess=function(L){var x=L.target.result;if(x)return $();var D={digest:k,body:R},I=w.put(D);I.onsuccess=$}}}function yr(e,t,n,r,i){r===-1&&(r=1e3);var s=typeof e.getAll=="function"&&typeof e.getAllKeys=="function"&&r>1&&!n,u,v,_;function y(m){v=m.target.result,u&&i(u,v,_)}function w(m){u=m.target.result,v&&i(u,v,_)}function l(){if(!u.length)return i();var m=u[u.length-1],S;if(t&&t.upper)try{S=IDBKeyRange.bound(m,t.upper,!0,t.upperOpen)}catch(O){if(O.name==="DataError"&&O.code===0)return i()}else S=IDBKeyRange.lowerBound(m,!0);t=S,u=null,v=null,e.getAll(t,r).onsuccess=y,e.getAllKeys(t,r).onsuccess=w}function g(m){var S=m.target.result;if(!S)return i();i([S.key],[S.value],S)}s?(_={continue:l},e.getAll(t,r).onsuccess=y,e.getAllKeys(t,r).onsuccess=w):n?e.openCursor(t,"prev").onsuccess=g:e.openCursor(t).onsuccess=g}function Bs(e,t,n){if(typeof e.getAll=="function"){e.getAll(t).onsuccess=n;return}var r=[];function i(s){var u=s.target.result;u?(r.push(u.value),u.continue()):n({target:{result:r}})}e.openCursor(t).onsuccess=i}function Is(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(s,u){t.get(s).onsuccess=function(v){v.target.result?r[u]=v.target.result:r[u]={key:s,error:"not_found"},i++,i===e.length&&n(e,r,{})}})}function js(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(s){return{error:s}}return null}function $s(e,t,n){var r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,s="key"in e?e.key:!1,u="keys"in e?e.keys:!1,v=e.skip||0,_=typeof e.limit=="number"?e.limit:-1,y=e.inclusive_end!==!1,w,l;if(!u&&(w=js(r,i,y,s,e.descending),l=w&&w.error,l&&!(l.name==="DataError"&&l.code===0)))return n(G(Qt,l.name,l.message));var g=[ie,ce,fe];e.attachments&&g.push(ve);var m=me(t,g,"readonly");if(m.error)return n(m.error);var S=m.txn;S.oncomplete=F,S.onabort=Se(n);var O=S.objectStore(ie),p=S.objectStore(ce),h=S.objectStore(fe),d=p.index("_doc_id_rev"),o=[],a,c;h.get(fe).onsuccess=function(j){a=j.target.result.docCount},e.update_seq&&(p.openKeyCursor(null,"prev").onsuccess=j=>{var N=j.target.result;N&&N.key&&(c=N.key)});function f(j,N,z){var Q=j.id+"::"+z;d.get(Q).onsuccess=function(b){if(N.doc=it(b.target.result)||{},e.conflicts){var A=rn(j);A.length&&(N.doc._conflicts=A)}_r(N.doc,e,S)}}function q(j,N){var z={id:N.id,key:N.id,value:{rev:j}},Q=N.deleted;Q?u&&(o.push(z),z.value.deleted=!0,z.doc=null):v--<=0&&(o.push(z),e.include_docs&&f(N,z,j))}function C(j){for(var N=0,z=j.length;N<z&&o.length!==_;N++){var Q=j[N];if(Q.error&&u){o.push(Q);continue}var W=Te(Q),b=W.winningRev;q(b,W)}}function E(j,N,z){z&&(C(N),o.length<_&&z.continue())}function P(j){var N=j.target.result;e.descending&&(N=N.reverse()),C(N)}function B(){var j={total_rows:a,offset:e.skip,rows:o};e.update_seq&&c!==void 0&&(j.update_seq=c),n(null,j)}function F(){e.attachments?Bt(o,e.binary).then(B):B()}if(!(l||_===0)){if(u)return Is(u,O,E);if(_===-1)return Bs(O,w,P);yr(O,w,e.descending,_+v,E)}}function Ns(e,t){var n=e.objectStore(ie).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){t(r.target.result)}}var It=!1,jt=[];function Ks(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}}function An(){It||!jt.length||(It=!0,jt.shift()())}function Ms(e,t,n){jt.push(function(){e(function(s,u){Ks(t,s,u,n),It=!1,qe(function(){An()})})}),An()}function Fs(e,t,n,r){if(e=ae(e),e.continuous){var i=n+":"+ot();return Ue.addListener(n,i,t,e),Ue.notify(n),{cancel:function(){Ue.removeListener(n,i)}}}var s=e.doc_ids&&new Set(e.doc_ids);e.since=e.since||0;var u=e.since,v="limit"in e?e.limit:-1;v===0&&(v=1);var _=[],y=0,w=Wt(e),l=new Map,g,m,S,O;function p(C,E,P){if(!P||!C.length)return;var B=new Array(C.length),F=new Array(C.length);function j(Q,W){var b=e.processChange(W,Q,e);u=b.seq=Q.seq;var A=w(b);return typeof A=="object"?Promise.reject(A):A?(y++,e.return_docs&&_.push(b),e.attachments&&e.include_docs?new Promise(function(T){_r(W,e,g,function(){Bt([b],e.binary).then(function(){T(b)})})}):Promise.resolve(b)):Promise.resolve()}function N(){for(var Q=[],W=0,b=B.length;W<b&&y!==v;W++){var A=B[W];if(A){var T=F[W];Q.push(j(T,A))}}Promise.all(Q).then(function(k){for(var R=0,$=k.length;R<$;R++)k[R]&&e.onChange(k[R])}).catch(e.complete),y!==v&&P.continue()}var z=0;E.forEach(function(Q,W){var b=it(Q),A=C[W];d(b,A,function(T,k){F[W]=T,B[W]=k,++z===C.length&&N()})})}function h(C,E,P,B){if(P.seq!==E)return B();if(P.winningRev===C._rev)return B(P,C);var F=C._id+"::"+P.winningRev,j=O.get(F);j.onsuccess=function(N){B(P,it(N.target.result))}}function d(C,E,P){if(s&&!s.has(C._id))return P();var B=l.get(C._id);if(B)return h(C,E,B,P);S.get(C._id).onsuccess=function(F){B=Te(F.target.result),l.set(C._id,B),h(C,E,B,P)}}function o(){e.complete(null,{results:_,last_seq:u})}function a(){!e.continuous&&e.attachments?Bt(_).then(o):o()}var c=[ie,ce];e.attachments&&c.push(ve);var f=me(r,c,"readonly");if(f.error)return e.complete(f.error);g=f.txn,g.onabort=Se(e.complete),g.oncomplete=a,m=g.objectStore(ce),S=g.objectStore(ie),O=m.index("_doc_id_rev");var q=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;yr(m,q,e.descending,v,p)}var Ie=new Map,pt,mt=new Map;function pr(e,t){var n=this;Ms(function(r){Us(n,e,r)},t,n.constructor)}function Us(e,t,n){var r=t.name,i=null,s=null;e._meta=null;function u(p){return function(h,d){h&&h instanceof Error&&!h.reason&&s&&(h.reason=s),p(h,d)}}function v(p){var h=p.createObjectStore(ie,{keyPath:"id"});p.createObjectStore(ce,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),p.createObjectStore(ve,{keyPath:"digest"}),p.createObjectStore(fe,{keyPath:"id",autoIncrement:!1}),p.createObjectStore(yt),h.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),p.createObjectStore(be,{keyPath:"_id"});var d=p.createObjectStore(De,{autoIncrement:!0});d.createIndex("seq","seq"),d.createIndex("digestSeq","digestSeq",{unique:!0})}function _(p,h){var d=p.objectStore(ie);d.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),d.openCursor().onsuccess=function(o){var a=o.target.result;if(a){var c=a.value,f=Oe(c);c.deletedOrLocal=f?"1":"0",d.put(c),a.continue()}else h()}}function y(p){p.createObjectStore(be,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function w(p,h){var d=p.objectStore(be),o=p.objectStore(ie),a=p.objectStore(ce),c=o.openCursor();c.onsuccess=function(f){var q=f.target.result;if(q){var C=q.value,E=C.id,P=Pe(E),B=Re(C);if(P){var F=E+"::"+B,j=E+"::",N=E+"::~",z=a.index("_doc_id_rev"),Q=IDBKeyRange.bound(j,N,!1,!1),W=z.openCursor(Q);W.onsuccess=function(b){if(W=b.target.result,!W)o.delete(q.primaryKey),q.continue();else{var A=W.value;A._doc_id_rev===F&&d.put(A),a.delete(W.primaryKey),W.continue()}}}else q.continue()}else h&&h()}}function l(p){var h=p.createObjectStore(De,{autoIncrement:!0});h.createIndex("seq","seq"),h.createIndex("digestSeq","digestSeq",{unique:!0})}function g(p,h){var d=p.objectStore(ce),o=p.objectStore(ve),a=p.objectStore(De),c=o.count();c.onsuccess=function(f){var q=f.target.result;if(!q)return h();d.openCursor().onsuccess=function(C){var E=C.target.result;if(!E)return h();for(var P=E.value,B=E.primaryKey,F=Object.keys(P._attachments||{}),j={},N=0;N<F.length;N++){var z=P._attachments[F[N]];j[z.digest]=!0}var Q=Object.keys(j);for(N=0;N<Q.length;N++){var W=Q[N];a.put({seq:B,digestSeq:W+"::"+B})}E.continue()}}}function m(p){function h(c){return c.data?Te(c):(c.deleted=c.deletedOrLocal==="1",c)}var d=p.objectStore(ce),o=p.objectStore(ie),a=o.openCursor();a.onsuccess=function(c){var f=c.target.result;if(!f)return;var q=h(f.value);q.winningRev=q.winningRev||Re(q);function C(){var P=q.id+"::",B=q.id+"::￿",F=d.index("_doc_id_rev").openCursor(IDBKeyRange.bound(P,B)),j=0;F.onsuccess=function(N){var z=N.target.result;if(!z)return q.seq=j,E();var Q=z.primaryKey;Q>j&&(j=Q),z.continue()}}function E(){var P=Lt(q,q.winningRev,q.deleted),B=o.put(P);B.onsuccess=function(){f.continue()}}if(q.seq)return E();C()}}e._remote=!1,e.type=function(){return"idb"},e._id=Gn(function(p){p(null,e._meta.instanceId)}),e._bulkDocs=function(h,d,o){Ls(t,h,d,e,i,u(o))},e._get=function(h,d,o){var a,c,f,q=d.ctx;if(!q){var C=me(i,[ie,ce,ve],"readonly");if(C.error)return o(C.error);q=C.txn}function E(){o(f,{doc:a,metadata:c,ctx:q})}q.objectStore(ie).get(h).onsuccess=function(P){if(c=Te(P.target.result),!c)return f=G(he,"missing"),E();var B;if(d.rev)B=d.latest?wi(d.rev,c):d.rev;else{B=c.winningRev;var F=Oe(c);if(F)return f=G(he,"deleted"),E()}var j=q.objectStore(ce),N=c.id+"::"+B;j.index("_doc_id_rev").get(N).onsuccess=function(z){if(a=z.target.result,a&&(a=it(a)),!a)return f=G(he,"missing"),E();E()}}},e._getAttachment=function(p,h,d,o,a){var c;if(o.ctx)c=o.ctx;else{var f=me(i,[ie,ce,ve],"readonly");if(f.error)return a(f.error);c=f.txn}var q=d.digest,C=d.content_type;c.objectStore(ve).get(q).onsuccess=function(E){var P=E.target.result.body;vr(P,C,o.binary,function(B){a(null,B)})}},e._info=function(h){var d,o,a=me(i,[fe,ce],"readonly");if(a.error)return h(a.error);var c=a.txn;c.objectStore(fe).get(fe).onsuccess=function(f){o=f.target.result.docCount},c.objectStore(ce).openKeyCursor(null,"prev").onsuccess=function(f){var q=f.target.result;d=q?q.key:0},c.oncomplete=function(){h(null,{doc_count:o,update_seq:d,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(h,d){$s(h,i,u(d))},e._changes=function(h){return Fs(h,e,r,i)},e._close=function(p){i.close(),Ie.delete(r),p()},e._getRevisionTree=function(p,h){var d=me(i,[ie],"readonly");if(d.error)return h(d.error);var o=d.txn,a=o.objectStore(ie).get(p);a.onsuccess=function(c){var f=Te(c.target.result);f?h(null,f.rev_tree):h(G(he))}},e._doCompaction=function(p,h,d){var o=[ie,ce,ve,De],a=me(i,o,"readwrite");if(a.error)return d(a.error);var c=a.txn,f=c.objectStore(ie);f.get(p).onsuccess=function(q){var C=Te(q.target.result);Le(C.rev_tree,function(B,F,j,N,z){var Q=F+"-"+j;h.indexOf(Q)!==-1&&(z.status="missing")}),gr(h,p,c);var E=C.winningRev,P=C.deleted;c.objectStore(ie).put(Lt(C,E,P))},c.onabort=Se(d),c.oncomplete=function(){d()}},e._getLocal=function(p,h){var d=me(i,[be],"readonly");if(d.error)return h(d.error);var o=d.txn,a=o.objectStore(be).get(p);a.onerror=Se(h),a.onsuccess=function(c){var f=c.target.result;f?(delete f._doc_id_rev,h(null,f)):h(G(he))}},e._putLocal=function(p,h,d){typeof h=="function"&&(d=h,h={}),delete p._revisions;var o=p._rev,a=p._id;o?p._rev="0-"+(parseInt(o.split("-")[1],10)+1):p._rev="0-1";var c=h.ctx,f;if(!c){var q=me(i,[be],"readwrite");if(q.error)return d(q.error);c=q.txn,c.onerror=Se(d),c.oncomplete=function(){f&&d(null,f)}}var C=c.objectStore(be),E;o?(E=C.get(a),E.onsuccess=function(P){var B=P.target.result;if(!B||B._rev!==o)d(G(Ne));else{var F=C.put(p);F.onsuccess=function(){f={ok:!0,id:p._id,rev:p._rev},h.ctx&&d(null,f)}}}):(E=C.add(p),E.onerror=function(P){d(G(Ne)),P.preventDefault(),P.stopPropagation()},E.onsuccess=function(){f={ok:!0,id:p._id,rev:p._rev},h.ctx&&d(null,f)})},e._removeLocal=function(p,h,d){typeof h=="function"&&(d=h,h={});var o=h.ctx;if(!o){var a=me(i,[be],"readwrite");if(a.error)return d(a.error);o=a.txn,o.oncomplete=function(){c&&d(null,c)}}var c,f=p._id,q=o.objectStore(be),C=q.get(f);C.onerror=Se(d),C.onsuccess=function(E){var P=E.target.result;!P||P._rev!==p._rev?d(G(he)):(q.delete(f),c={ok:!0,id:f,rev:"0-0"},h.ctx&&d(null,c))}},e._destroy=function(p,h){Ue.removeAllListeners(r);var d=mt.get(r);d&&d.result&&(d.result.close(),Ie.delete(r));var o=indexedDB.deleteDatabase(r);o.onsuccess=function(){mt.delete(r),tt()&&r in localStorage&&delete localStorage[r],h(null,{ok:!0})},o.onerror=Se(h)};var S=Ie.get(r);if(S)return i=S.idb,e._meta=S.global,qe(function(){n(null,e)});var O=indexedDB.open(r,Ts);mt.set(r,O),O.onupgradeneeded=function(p){var h=p.target.result;if(p.oldVersion<1)return v(h);var d=p.currentTarget.transaction;p.oldVersion<3&&y(h),p.oldVersion<4&&l(h);var o=[_,w,g,m],a=p.oldVersion;function c(){var f=o[a-1];a++,f&&f(d,c)}c()},O.onsuccess=function(p){i=p.target.result,i.onversionchange=function(){i.close(),Ie.delete(r)},i.onabort=function(E){_e("error","Database has a global failure",E.target.error),s=E.target.error,i.close(),Ie.delete(r)};var h=i.transaction([fe,yt,ie],"readwrite"),d=!1,o,a,c,f;function q(){typeof c>"u"||!d||(e._meta={name:r,instanceId:f,blobSupport:c},Ie.set(r,{idb:i,global:e._meta}),n(null,e))}function C(){if(!(typeof a>"u"||typeof o>"u")){var E=r+"_id";E in o?f=o[E]:o[E]=f=ot(),o.docCount=a,h.objectStore(fe).put(o)}}h.objectStore(fe).get(fe).onsuccess=function(E){o=E.target.result||{id:fe},C()},Ns(h,function(E){a=E,C()}),pt||(pt=ms(h,yt,"key")),pt.then(function(E){c=E,q()}),h.oncomplete=function(){d=!0,q()},h.onabort=Se(n)},O.onerror=function(p){var h=p.target.error&&p.target.error.message;h?h.indexOf("stored database is a higher version")!==-1&&(h=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):h="Failed to open indexedDB, are you in private browsing mode?",_e("error",h),n(G(Qt,h))}}pr.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function Gs(e){e.adapter("idb",pr,!0)}function Js(e,t){return new Promise(function(n,r){var i=0,s=0,u=0,v=e.length,_;function y(){i++,e[s++]().then(l,g)}function w(){++u===v?_?r(_):n():m()}function l(){i--,w()}function g(S){i--,_=_||S,w()}function m(){for(;i<t&&s<v;)y()}m()})}const zs=25,Qs=50,Ye=5e3,Ws=1e4,wt={};function bt(e){const t=e.doc||e.ok,n=t&&t._attachments;n&&Object.keys(n).forEach(function(r){const i=n[r];i.data=Vt(i.data,i.content_type)})}function Ee(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):e.startsWith("_local/")?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function qn(e){return!e._attachments||!Object.keys(e._attachments)?Promise.resolve():Promise.all(Object.keys(e._attachments).map(function(t){const n=e._attachments[t];if(n.data&&typeof n.data!="string")return new Promise(function(r){en(n.data,r)}).then(function(r){n.data=r})}))}function Hs(e){if(!e.prefix)return!1;const t=Hn(e.prefix).protocol;return t==="http"||t==="https"}function Xs(e,t){if(Hs(t)){const i=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}const n=Hn(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});const r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function se(e,t){return et(e,e.db+"/"+t)}function et(e,t){const n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function Ze(e){const t=Object.keys(e);return t.length===0?"":"?"+t.map(n=>n+"="+encodeURIComponent(e[n])).join("&")}function Ys(e){const t=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=t.indexOf("msie")!==-1,r=t.indexOf("trident")!==-1,i=t.indexOf("edge")!==-1,s=!("method"in e)||e.method==="GET";return(n||r||i)&&s}function $t(e,t){const n=this,r=Xs(e.name,e),i=se(r,"");e=ae(e);const s=async function(l,g){if(g=g||{},g.headers=g.headers||new je,g.credentials="include",e.auth||r.auth){const O=e.auth||r.auth,p=O.username+":"+O.password,h=ze(unescape(encodeURIComponent(p)));g.headers.set("Authorization","Basic "+h)}const m=e.headers||{};return Object.keys(m).forEach(function(O){g.headers.append(O,m[O])}),Ys(g)&&(l+=(l.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),await(e.fetch||ar)(l,g)};function u(l,g){return te(l,function(...m){y().then(function(){return g.apply(this,m)}).catch(function(S){m.pop()(S)})}).bind(n)}async function v(l,g){const m={};g=g||{},g.headers=g.headers||new je,g.headers.get("Content-Type")||g.headers.set("Content-Type","application/json"),g.headers.get("Accept")||g.headers.set("Accept","application/json");const S=await s(l,g);m.ok=S.ok,m.status=S.status;const O=await S.json();if(m.data=O,!m.ok)throw m.data.status=m.status,Ke(m.data);return Array.isArray(m.data)&&(m.data=m.data.map(function(p){return p.error||p.missing?Ke(p):p})),m}let _;async function y(){return e.skip_setup?Promise.resolve():_||(_=v(i).catch(function(l){return l&&l.status&&l.status===404?(Et(404,"PouchDB is just detecting if the remote exists."),v(i,{method:"PUT"})):Promise.reject(l)}).catch(function(l){return l&&l.status&&l.status===412?!0:Promise.reject(l)}),_.catch(function(){_=null}),_)}qe(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=u("id",async function(l){let g;try{g=await(await s(et(r,""))).json()}catch{g={}}const m=g&&g.uuid?g.uuid+r.db:se(r,"");l(null,m)}),n.compact=u("compact",async function(l,g){typeof l=="function"&&(g=l,l={}),l=ae(l),await v(se(r,"_compact"),{method:"POST"});function m(){n.info(function(S,O){O&&!O.compact_running?g(null,{ok:!0}):setTimeout(m,l.interval||200)})}m()}),n.bulkGet=te("bulkGet",function(l,g){const m=this;async function S(d){const o={};l.revs&&(o.revs=!0),l.attachments&&(o.attachments=!0),l.latest&&(o.latest=!0);try{const a=await v(se(r,"_bulk_get"+Ze(o)),{method:"POST",body:JSON.stringify({docs:l.docs})});l.attachments&&l.binary&&a.data.results.forEach(function(c){c.docs.forEach(bt)}),d(null,a.data)}catch(a){d(a)}}function O(){const d=Qs,o=Math.ceil(l.docs.length/d);let a=0;const c=new Array(o);function f(q){return function(C,E){c[q]=E.results,++a===o&&g(null,{results:c.flat()})}}for(let q=0;q<o;q++){const C=Je(l,["revs","attachments","binary","latest"]);C.docs=l.docs.slice(q*d,Math.min(l.docs.length,(q+1)*d)),Jn(m,C,f(q))}}const p=et(r,""),h=wt[p];typeof h!="boolean"?S(function(d,o){d?(wt[p]=!1,Et(d.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),O()):(wt[p]=!0,g(null,o))}):h?S(g):O()}),n._info=async function(l){try{await y();const m=await(await s(se(r,""))).json();m.host=se(r,""),l(null,m)}catch(g){l(g)}},n.fetch=async function(l,g){await y();const m=l.substring(0,1)==="/"?et(r,l.substring(1)):se(r,l);return s(m,g)},n.get=u("get",async function(l,g,m){typeof g=="function"&&(m=g,g={}),g=ae(g);const S={};g.revs&&(S.revs=!0),g.revs_info&&(S.revs_info=!0),g.latest&&(S.latest=!0),g.open_revs&&(g.open_revs!=="all"&&(g.open_revs=JSON.stringify(g.open_revs)),S.open_revs=g.open_revs),g.rev&&(S.rev=g.rev),g.conflicts&&(S.conflicts=g.conflicts),g.update_seq&&(S.update_seq=g.update_seq),l=Ee(l);function O(d){const o=d._attachments,a=o&&Object.keys(o);if(!o||!a.length)return;async function c(q){const C=o[q],E=Ee(d._id)+"/"+w(q)+"?rev="+d._rev,P=await s(se(r,E));let B;"buffer"in P?B=await P.buffer():B=await P.blob();let F;if(g.binary){const j=Object.getOwnPropertyDescriptor(B.__proto__,"type");(!j||j.set)&&(B.type=C.content_type),F=B}else F=await new Promise(function(j){en(B,j)});delete C.stub,delete C.length,C.data=F}const f=a.map(function(q){return function(){return c(q)}});return Js(f,5)}function p(d){return Array.isArray(d)?Promise.all(d.map(function(o){if(o.ok)return O(o.ok)})):O(d)}const h=se(r,l+Ze(S));try{const d=await v(h);g.attachments&&await p(d.data),m(null,d.data)}catch(d){d.docId=l,m(d)}}),n.remove=u("remove",async function(l,g,m,S){let O;typeof g=="string"?(O={_id:l,_rev:g},typeof m=="function"&&(S=m,m={})):(O=l,typeof g=="function"?(S=g,m={}):(S=m,m=g));const p=O._rev||m.rev,h=se(r,Ee(O._id))+"?rev="+p;try{const d=await v(h,{method:"DELETE"});S(null,d.data)}catch(d){S(d)}});function w(l){return l.split("/").map(encodeURIComponent).join("/")}n.getAttachment=u("getAttachment",async function(l,g,m,S){typeof m=="function"&&(S=m,m={});const O=m.rev?"?rev="+m.rev:"",p=se(r,Ee(l))+"/"+w(g)+O;let h;try{const d=await s(p,{method:"GET"});if(!d.ok)throw d;h=d.headers.get("content-type");let o;if(typeof process<"u"&&!process.browser&&typeof d.buffer=="function"?o=await d.buffer():o=await d.blob(),typeof process<"u"&&!process.browser){const a=Object.getOwnPropertyDescriptor(o.__proto__,"type");(!a||a.set)&&(o.type=h)}S(null,o)}catch(d){S(d)}}),n.removeAttachment=u("removeAttachment",async function(l,g,m,S){const O=se(r,Ee(l)+"/"+w(g))+"?rev="+m;try{const p=await v(O,{method:"DELETE"});S(null,p.data)}catch(p){S(p)}}),n.putAttachment=u("putAttachment",async function(l,g,m,S,O,p){typeof O=="function"&&(p=O,O=S,S=m,m=null);const h=Ee(l)+"/"+w(g);let d=se(r,h);if(m&&(d+="?rev="+m),typeof S=="string"){let o;try{o=Xt(S)}catch{return p(G(Qn,"Attachment is not a valid base64 string"))}S=o?Zt(o,O):""}try{const o=await v(d,{headers:new je({"Content-Type":O}),method:"PUT",body:S});p(null,o.data)}catch(o){p(o)}}),n._bulkDocs=async function(l,g,m){l.new_edits=g.new_edits;try{await y(),await Promise.all(l.docs.map(qn));const S=await v(se(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(l)});m(null,S.data)}catch(S){m(S)}},n._put=async function(l,g,m){try{await y(),await qn(l);const S=await v(se(r,Ee(l._id)),{method:"PUT",body:JSON.stringify(l)});m(null,S.data)}catch(S){S.docId=l&&l._id,m(S)}},n.allDocs=u("allDocs",async function(l,g){typeof l=="function"&&(g=l,l={}),l=ae(l);const m={};let S,O="GET";l.conflicts&&(m.conflicts=!0),l.update_seq&&(m.update_seq=!0),l.descending&&(m.descending=!0),l.include_docs&&(m.include_docs=!0),l.attachments&&(m.attachments=!0),l.key&&(m.key=JSON.stringify(l.key)),l.start_key&&(l.startkey=l.start_key),l.startkey&&(m.startkey=JSON.stringify(l.startkey)),l.end_key&&(l.endkey=l.end_key),l.endkey&&(m.endkey=JSON.stringify(l.endkey)),typeof l.inclusive_end<"u"&&(m.inclusive_end=!!l.inclusive_end),typeof l.limit<"u"&&(m.limit=l.limit),typeof l.skip<"u"&&(m.skip=l.skip);const p=Ze(m);typeof l.keys<"u"&&(O="POST",S={keys:l.keys});try{const h=await v(se(r,"_all_docs"+p),{method:O,body:JSON.stringify(S)});l.include_docs&&l.attachments&&l.binary&&h.data.rows.forEach(bt),g(null,h.data)}catch(h){g(h)}}),n._changes=function(l){const g="batch_size"in l?l.batch_size:zs;l=ae(l),l.continuous&&!("heartbeat"in l)&&(l.heartbeat=Ws);let m="timeout"in l?l.timeout:30*1e3;"timeout"in l&&l.timeout&&m-l.timeout<Ye&&(m=l.timeout+Ye),"heartbeat"in l&&l.heartbeat&&m-l.heartbeat<Ye&&(m=l.heartbeat+Ye);const S={};"timeout"in l&&l.timeout&&(S.timeout=l.timeout);const O=typeof l.limit<"u"?l.limit:!1;let p=O;if(l.style&&(S.style=l.style),(l.include_docs||l.filter&&typeof l.filter=="function")&&(S.include_docs=!0),l.attachments&&(S.attachments=!0),l.continuous&&(S.feed="longpoll"),l.seq_interval&&(S.seq_interval=l.seq_interval),l.conflicts&&(S.conflicts=!0),l.descending&&(S.descending=!0),l.update_seq&&(S.update_seq=!0),"heartbeat"in l&&l.heartbeat&&(S.heartbeat=l.heartbeat),l.filter&&typeof l.filter=="string"&&(S.filter=l.filter),l.view&&typeof l.view=="string"&&(S.filter="_view",S.view=l.view),l.query_params&&typeof l.query_params=="object")for(const C in l.query_params)Object.prototype.hasOwnProperty.call(l.query_params,C)&&(S[C]=l.query_params[C]);let h="GET",d;l.doc_ids?(S.filter="_doc_ids",h="POST",d={doc_ids:l.doc_ids}):l.selector&&(S.filter="_selector",h="POST",d={selector:l.selector});const o=new AbortController;let a;const c=async function(C,E){if(l.aborted)return;S.since=C,typeof S.since=="object"&&(S.since=JSON.stringify(S.since)),l.descending?O&&(S.limit=p):S.limit=!O||p>g?g:p;const P=se(r,"_changes"+Ze(S)),B={signal:o.signal,method:h,body:JSON.stringify(d)};if(a=C,!l.aborted)try{await y();const F=await v(P,B);E(null,F.data)}catch(F){E(F)}},f={results:[]},q=function(C,E){if(l.aborted)return;let P=0;if(E&&E.results){P=E.results.length,f.last_seq=E.last_seq;let F=null,j=null;typeof E.pending=="number"&&(F=E.pending),(typeof f.last_seq=="string"||typeof f.last_seq=="number")&&(j=f.last_seq),l.query_params,E.results=E.results.filter(function(N){p--;const z=Wt(l)(N);return z&&(l.include_docs&&l.attachments&&l.binary&&bt(N),l.return_docs&&f.results.push(N),l.onChange(N,F,j)),z})}else if(C){l.aborted=!0,l.complete(C);return}E&&E.last_seq&&(a=E.last_seq);const B=O&&p<=0||E&&P<g||l.descending;l.continuous&&!(O&&p<=0)||!B?qe(function(){c(a,q)}):l.complete(null,f)};return c(l.since||0,q),{cancel:function(){l.aborted=!0,o.abort()}}},n.revsDiff=u("revsDiff",async function(l,g,m){typeof g=="function"&&(m=g,g={});try{const S=await v(se(r,"_revs_diff"),{method:"POST",body:JSON.stringify(l)});m(null,S.data)}catch(S){m(S)}}),n._close=function(l){l()},n._destroy=async function(l,g){try{const m=await v(se(r,""),{method:"DELETE"});g(null,m)}catch(m){m.status===404?g(null,{ok:!0}):g(m)}}}$t.valid=function(){return!0};function Zs(e){e.adapter("http",$t,!1),e.adapter("https",$t,!1)}class ke extends Error{constructor(t){super(),this.status=400,this.name="query_parse_error",this.message=t,this.error=!0;try{Error.captureStackTrace(this,ke)}catch{}}}class ut extends Error{constructor(t){super(),this.status=404,this.name="not_found",this.message=t,this.error=!0;try{Error.captureStackTrace(this,ut)}catch{}}}class ct extends Error{constructor(t){super(),this.status=500,this.name="invalid_value",this.message=t,this.error=!0;try{Error.captureStackTrace(this,ct)}catch{}}}function mr(e,t){return t&&e.then(function(n){qe(function(){t(null,n)})},function(n){qe(function(){t(n)})}),e}function Vs(e){return function(...t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&mr(r,n),r}}function ea(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function St(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function On(e){var t=new Set(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function At(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function Cn(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new ct(t)}function Nt(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if(typeof i!="number")if(Array.isArray(i)){t=typeof t=="number"?[t]:t;for(var s=0,u=i.length;s<u;s++){var v=i[s];if(typeof v!="number")throw Cn("_sum");typeof t[s]>"u"?t.push(v):t[s]+=v}}else throw Cn("_sum");else typeof t=="number"?t+=i:t[0]+=i}return t}var ta=_e.bind(null,"log"),na=Array.isArray,ra=JSON.parse;function wr(e,t){return Ht("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Nt,log:ta,isArray:na,toJSON:ra})}class Kt{constructor(){this.promise=Promise.resolve()}add(t){return this.promise=this.promise.catch(()=>{}).then(()=>t()),this.promise}finish(){return this.promise}}function xn(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function ia(e,t){return xn(e)+xn(t)+"undefined"}async function En(e,t,n,r,i,s){const u=ia(n,r);let v;if(!i&&(v=e._cachedViews=e._cachedViews||{},v[u]))return v[u];const _=e.info().then(async function(y){const w=y.db_name+"-mrview-"+(i?"temp":Zn(u));function l(p){p.views=p.views||{};let h=t;h.indexOf("/")===-1&&(h=t+"/"+t);const d=p.views[h]=p.views[h]||{};if(!d[w])return d[w]=!0,p}await nt(e,"_local/"+s,l);const m=(await e.registerDependentDatabase(w)).db;m.auto_compaction=!0;const S={name:w,db:m,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};let O;try{O=await S.db.get("_local/lastSeq")}catch(p){if(p.status!==404)throw p}return S.seq=O?O.seq:0,v&&S.db.once("destroyed",function(){delete v[u]}),S});return v&&(v[u]=_),_}const kn={},Dn=new Kt,sa=50;function qt(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function aa(e){return e.length===1&&/^1-/.test(e[0].rev)}function Tn(e,t,n){try{e.emit("error",t)}catch{_e("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),_e("error",t,n)}}function oa(e,t,n,r){function i(b,A,T){try{A(T)}catch(k){Tn(b,k,{fun:A,doc:T})}}function s(b,A,T,k,R){try{return{output:A(T,k,R)}}catch($){return Tn(b,$,{fun:A,keys:T,values:k,rereduce:R}),{error:$}}}function u(b,A){const T=ne(b.key,A.key);return T!==0?T:ne(b.value,A.value)}function v(b,A,T){return T=T||0,typeof A=="number"?b.slice(T,A+T):T>0?b.slice(T):b}function _(b){const A=b.value;return A&&typeof A=="object"&&A._id||b.id}function y(b){for(const A of b.rows){const T=A.doc&&A.doc._attachments;if(T)for(const k of Object.keys(T)){const R=T[k];T[k].data=Vt(R.data,R.content_type)}}}function w(b){return function(A){return b.include_docs&&b.attachments&&b.binary&&y(A),A}}function l(b,A,T,k){let R=A[b];typeof R<"u"&&(k&&(R=encodeURIComponent(JSON.stringify(R))),T.push(b+"="+R))}function g(b){if(typeof b<"u"){const A=Number(b);return!isNaN(A)&&A===parseInt(b,10)?A:b}}function m(b){return b.group_level=g(b.group_level),b.limit=g(b.limit),b.skip=g(b.skip),b}function S(b){if(b){if(typeof b!="number")return new ke(`Invalid value for integer: "${b}"`);if(b<0)return new ke(`Invalid value for positive integer: "${b}"`)}}function O(b,A){const T=b.descending?"endkey":"startkey",k=b.descending?"startkey":"endkey";if(typeof b[T]<"u"&&typeof b[k]<"u"&&ne(b[T],b[k])>0)throw new ke("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(A.reduce&&b.reduce!==!1){if(b.include_docs)throw new ke("{include_docs:true} is invalid for reduce");if(b.keys&&b.keys.length>1&&!b.group&&!b.group_level)throw new ke("Multi-key fetches for reduce views must use {group: true}")}for(const R of["group_level","limit","skip"]){const $=S(b[R]);if($)throw $}}async function p(b,A,T){let k=[],R,$="GET",U;if(l("reduce",T,k),l("include_docs",T,k),l("attachments",T,k),l("limit",T,k),l("descending",T,k),l("group",T,k),l("group_level",T,k),l("skip",T,k),l("stale",T,k),l("conflicts",T,k),l("startkey",T,k,!0),l("start_key",T,k,!0),l("endkey",T,k,!0),l("end_key",T,k,!0),l("inclusive_end",T,k),l("key",T,k,!0),l("update_seq",T,k),k=k.join("&"),k=k===""?"":"?"+k,typeof T.keys<"u"){const I=`keys=${encodeURIComponent(JSON.stringify(T.keys))}`;I.length+k.length+1<=2e3?k+=(k[0]==="?"?"&":"?")+I:($="POST",typeof A=="string"?R={keys:T.keys}:A.keys=T.keys)}if(typeof A=="string"){const D=qt(A),I=await b.fetch("_design/"+D[0]+"/_view/"+D[1]+k,{headers:new je({"Content-Type":"application/json"}),method:$,body:JSON.stringify(R)});U=I.ok;const K=await I.json();if(!U)throw K.status=I.status,Ke(K);for(const M of K.rows)if(M.value&&M.value.error&&M.value.error==="builtin_reduce_error")throw new Error(M.reason);return new Promise(function(M){M(K)}).then(w(T))}R=R||{};for(const D of Object.keys(A))Array.isArray(A[D])?R[D]=A[D]:R[D]=A[D].toString();const L=await b.fetch("_temp_view"+k,{headers:new je({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(R)});U=L.ok;const x=await L.json();if(!U)throw x.status=L.status,Ke(x);return new Promise(function(D){D(x)}).then(w(T))}function h(b,A,T){return new Promise(function(k,R){b._query(A,T,function($,U){if($)return R($);k(U)})})}function d(b){return new Promise(function(A,T){b._viewCleanup(function(k,R){if(k)return T(k);A(R)})})}function o(b){return function(A){if(A.status===404)return b;throw A}}async function a(b,A,T){const k="_local/doc_"+b,R={_id:k,keys:[]},$=T.get(b),U=$[0],L=$[1];function x(){return aa(L)?Promise.resolve(R):A.db.get(k).catch(o(R))}function D(Y){return Y.keys.length?A.db.allDocs({keys:Y.keys,include_docs:!0}):Promise.resolve({rows:[]})}function I(Y,ee){const re=[],le=new Set;for(const X of ee.rows){const H=X.doc;if(H&&(re.push(H),le.add(H._id),H._deleted=!U.has(H._id),!H._deleted)){const Z=U.get(H._id);"value"in Z&&(H.value=Z.value)}}const we=At(U);for(const X of we)if(!le.has(X)){const H={_id:X},Z=U.get(X);"value"in Z&&(H.value=Z.value),re.push(H)}return Y.keys=On(we.concat(Y.keys)),re.push(Y),re}const K=await x(),M=await D(K);return I(K,M)}function c(b){return b.sourceDB.get("_local/purges").then(function(A){const T=A.purgeSeq;return b.db.get("_local/purgeSeq").then(function(k){return k._rev}).catch(o(void 0)).then(function(k){return b.db.put({_id:"_local/purgeSeq",_rev:k,purgeSeq:T})})}).catch(function(A){if(A.status!==404)throw A})}function f(b,A,T){var k="_local/lastSeq";return b.db.get(k).catch(o({_id:k,seq:0})).then(function(R){var $=At(A);return Promise.all($.map(function(U){return a(U,b,A)})).then(function(U){var L=U.flat();return R.seq=T,L.push(R),b.db.bulkDocs({docs:L})}).then(()=>c(b))})}function q(b){const A=typeof b=="string"?b:b.name;let T=kn[A];return T||(T=kn[A]=new Kt),T}async function C(b,A){return St(q(b),function(){return E(b,A)})()}async function E(b,A){let T,k,R;function $(X,H){const Z={id:k._id,key:Be(X)};typeof H<"u"&&H!==null&&(Z.value=Be(H)),T.push(Z)}const U=t(b.mapFun,$);let L=b.seq||0;function x(){return b.sourceDB.info().then(function(X){R=b.sourceDB.activeTasks.add({name:"view_indexing",total_items:X.update_seq-L})})}function D(X,H){return function(){return f(b,X,H)}}let I=0;const K={view:b.name,indexed_docs:I};b.sourceDB.emit("indexing",K);const M=new Kt;async function Y(){const X=await b.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:L,limit:A.changes_batch_size}),H=await ee();return re(X,H)}function ee(){return b.db.get("_local/purgeSeq").then(function(X){return X.purgeSeq}).catch(o(-1)).then(function(X){return b.sourceDB.get("_local/purges").then(function(H){const Z=H.purges.filter(function(de,oe){return oe>X}).map(de=>de.docId),ge=Z.filter(function(de,oe){return Z.indexOf(de)===oe});return Promise.all(ge.map(function(de){return b.sourceDB.get(de).then(function(oe){return{docId:de,doc:oe}}).catch(o({docId:de}))}))}).catch(o([]))})}function re(X,H){const Z=X.results;if(!Z.length&&!H.length)return;for(const oe of H)if(Z.findIndex(function(Me){return Me.id===oe.docId})<0){const Me={_id:oe.docId,doc:{_id:oe.docId,_deleted:1},changes:[]};oe.doc&&(Me.doc=oe.doc,Me.changes.push({rev:oe.doc._rev})),Z.push(Me)}const ge=le(Z);M.add(D(ge,L)),I=I+Z.length;const de={view:b.name,last_seq:X.last_seq,results_count:Z.length,indexed_docs:I};if(b.sourceDB.emit("indexing",de),b.sourceDB.activeTasks.update(R,{completed_items:I}),!(Z.length<A.changes_batch_size))return Y()}function le(X){const H=new Map;for(const Z of X){if(Z.doc._id[0]!=="_"){T=[],k=Z.doc,k._deleted||i(b.sourceDB,U,k),T.sort(u);const ge=we(T);H.set(Z.doc._id,[ge,Z.changes])}L=Z.seq}return H}function we(X){const H=new Map;let Z;for(let ge=0,de=X.length;ge<de;ge++){const oe=X[ge],ft=[oe.key,oe.id];ge>0&&ne(oe.key,Z)===0&&ft.push(ge),H.set(pe(ft),oe),Z=oe.key}return H}try{await x(),await Y(),await M.finish(),b.seq=L,b.sourceDB.activeTasks.remove(R)}catch(X){b.sourceDB.activeTasks.remove(R,X)}}function P(b,A,T){T.group_level===0&&delete T.group_level;const k=T.group||T.group_level,R=n(b.reduceFun),$=[],U=isNaN(T.group_level)?Number.POSITIVE_INFINITY:T.group_level;for(const L of A){const x=$[$.length-1];let D=k?L.key:null;if(k&&Array.isArray(D)&&(D=D.slice(0,U)),x&&ne(x.groupKey,D)===0){x.keys.push([L.key,L.id]),x.values.push(L.value);continue}$.push({keys:[[L.key,L.id]],values:[L.value],groupKey:D})}A=[];for(const L of $){const x=s(b.sourceDB,R,L.keys,L.values,!1);if(x.error&&x.error instanceof ct)throw x.error;A.push({value:x.error?null:x.output,key:L.groupKey})}return{rows:v(A,T.limit,T.skip)}}function B(b,A){return St(q(b),function(){return F(b,A)})()}async function F(b,A){let T;const k=b.reduceFun&&A.reduce!==!1,R=A.skip||0;typeof A.keys<"u"&&!A.keys.length&&(A.limit=0,delete A.keys);async function $(L){L.include_docs=!0;const x=await b.db.allDocs(L);return T=x.total_rows,x.rows.map(function(D){if("value"in D.doc&&typeof D.doc.value=="object"&&D.doc.value!==null){const K=Object.keys(D.doc.value).sort(),M=["id","key","value"];if(!(K<M||K>M))return D.doc.value}const I=Zi(D.doc._id);return{key:I[0],id:I[1],value:"value"in D.doc?D.doc.value:null}})}async function U(L){let x;if(k?x=P(b,L,A):typeof A.keys>"u"?x={total_rows:T,offset:R,rows:L}:x={total_rows:T,offset:R,rows:v(L,A.limit,A.skip)},A.update_seq&&(x.update_seq=b.seq),A.include_docs){const D=On(L.map(_)),I=await b.sourceDB.allDocs({keys:D,include_docs:!0,conflicts:A.conflicts,attachments:A.attachments,binary:A.binary}),K=new Map;for(const M of I.rows)K.set(M.id,M.doc);for(const M of L){const Y=_(M),ee=K.get(Y);ee&&(M.doc=ee)}}return x}if(typeof A.keys<"u"){const x=A.keys.map(function(K){const M={startkey:pe([K]),endkey:pe([K,{}])};return A.update_seq&&(M.update_seq=!0),$(M)}),I=(await Promise.all(x)).flat();return U(I)}else{const L={descending:A.descending};A.update_seq&&(L.update_seq=!0);let x,D;if("start_key"in A&&(x=A.start_key),"startkey"in A&&(x=A.startkey),"end_key"in A&&(D=A.end_key),"endkey"in A&&(D=A.endkey),typeof x<"u"&&(L.startkey=A.descending?pe([x,{}]):pe([x])),typeof D<"u"){let K=A.inclusive_end!==!1;A.descending&&(K=!K),L.endkey=pe(K?[D,{}]:[D])}if(typeof A.key<"u"){const K=pe([A.key]),M=pe([A.key,{}]);L.descending?(L.endkey=K,L.startkey=M):(L.startkey=K,L.endkey=M)}k||(typeof A.limit=="number"&&(L.limit=A.limit),L.skip=R);const I=await $(L);return U(I)}}async function j(b){return(await b.fetch("_view_cleanup",{headers:new je({"Content-Type":"application/json"}),method:"POST"})).json()}async function N(b){try{const A=await b.get("_local/"+e),T=new Map;for(const x of Object.keys(A.views)){const D=qt(x),I="_design/"+D[0],K=D[1];let M=T.get(I);M||(M=new Set,T.set(I,M)),M.add(K)}const k={keys:At(T),include_docs:!0},R=await b.allDocs(k),$={};for(const x of R.rows){const D=x.key.substring(8);for(const I of T.get(x.key)){let K=D+"/"+I;A.views[K]||(K=I);const M=Object.keys(A.views[K]),Y=x.doc&&x.doc.views&&x.doc.views[I];for(const ee of M)$[ee]=$[ee]||Y}}const L=Object.keys($).filter(function(x){return!$[x]}).map(function(x){return St(q(x),function(){return new b.constructor(x,b.__opts).destroy()})()});return Promise.all(L).then(function(){return{ok:!0}})}catch(A){if(A.status===404)return{ok:!0};throw A}}async function z(b,A,T){if(typeof b._query=="function")return h(b,A,T);if(Ae(b))return p(b,A,T);const k={changes_batch_size:b.__opts.view_update_changes_batch_size||sa};if(typeof A!="string")return O(T,A),Dn.add(async function(){const R=await En(b,"temp_view/temp_view",A.map,A.reduce,!0,e);return ea(C(R,k).then(function(){return B(R,T)}),function(){return R.db.destroy()})}),Dn.finish();{const R=A,$=qt(R),U=$[0],L=$[1],x=await b.get("_design/"+U);if(A=x.views&&x.views[L],!A)throw new ut(`ddoc ${x._id} has no view named ${L}`);r(x,L),O(T,A);const D=await En(b,R,A.map,A.reduce,!1,e);return T.stale==="ok"||T.stale==="update_after"?(T.stale==="update_after"&&qe(function(){C(D,k)}),B(D,T)):(await C(D,k),B(D,T))}}function Q(b,A,T){const k=this;typeof A=="function"&&(T=A,A={}),A=A?m(A):{},typeof b=="function"&&(b={map:b});const R=Promise.resolve().then(function(){return z(k,b,A)});return mr(R,T),R}const W=Vs(function(){const b=this;return typeof b._viewCleanup=="function"?d(b):Ae(b)?j(b):N(b)});return{query:Q,viewCleanup:W}}var Ot={_sum:function(e,t){return Nt(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(r){for(var i=0,s=0,u=r.length;s<u;s++){var v=r[s];i+=v*v}return i}return{sum:Nt(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}};function ua(e){if(/^_sum/.test(e))return Ot._sum;if(/^_count/.test(e))return Ot._count;if(/^_stats/.test(e))return Ot._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function ca(e,t){if(typeof e=="function"&&e.length===2){var n=e;return function(r){return n(r,t)}}else return wr(e.toString(),t)}function fa(e){var t=e.toString(),n=ua(t);return n||wr(t)}function la(e,t){var n=e.views&&e.views[t];if(typeof n.map!="string")throw new ut("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}var da="mrviews",br=oa(da,ca,fa,la);function ha(e,t,n){return br.query.call(this,e,t,n)}function va(e){return br.viewCleanup.call(this,e)}var _a={query:ha,viewCleanup:va};function ga(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function Pn(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function ya(e,t,n){var r=Ae(t)&&!Ae(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(s){return Promise.all(i.map(function(u){return ga(s,n,u)?t.getAttachment(n._id,u):e.getAttachment(s._id,u)}))}).catch(function(s){if(s.status!==404)throw s;return Pn(t,n)}):Pn(t,n)}function pa(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}function ma(e,t,n,r){n=ae(n);var i=[],s=!0;function u(){var _=pa(n);if(_.docs.length)return e.bulkGet(_).then(function(y){if(r.cancelled)throw new Error("cancelled");return Promise.all(y.results.map(function(w){return Promise.all(w.docs.map(function(l){var g=l.ok;return l.error&&(s=!1),!g||!g._attachments?g:ya(t,e,g).then(m=>{var S=Object.keys(g._attachments);return m.forEach(function(O,p){var h=g._attachments[S[p]];delete h.stub,delete h.length,h.data=O}),g})}))})).then(function(w){i=i.concat(w.flat().filter(Boolean))})})}function v(){return{ok:s,docs:i}}return Promise.resolve().then(u).then(v)}var Rn=1,Ln="pouchdb",wa=5,ye=0;function Mt(e,t,n,r,i){return e.get(t).catch(function(s){if(s.status===404)return(e.adapter==="http"||e.adapter==="https")&&Et(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:Ln,version:Rn};throw s}).then(function(s){if(!i.cancelled&&s.last_seq!==n)return s.history=(s.history||[]).filter(function(u){return u.session_id!==r}),s.history.unshift({last_seq:n,session_id:r}),s.history=s.history.slice(0,wa),s.version=Rn,s.replicator=Ln,s.session_id=r,s.last_seq=n,e.put(s).catch(function(u){if(u.status===409)return Mt(e,t,n,r,i);throw u})})}class Bn{constructor(t,n,r,i,s={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0}){this.src=t,this.target=n,this.id=r,this.returnValue=i,this.opts=s,typeof s.writeSourceCheckpoint>"u"&&(s.writeSourceCheckpoint=!0),typeof s.writeTargetCheckpoint>"u"&&(s.writeTargetCheckpoint=!0)}writeCheckpoint(t,n){var r=this;return this.updateTarget(t,n).then(function(){return r.updateSource(t,n)})}updateTarget(t,n){return this.opts.writeTargetCheckpoint?Mt(this.target,this.id,t,n,this.returnValue):Promise.resolve(!0)}updateSource(t,n){if(this.opts.writeSourceCheckpoint){var r=this;return Mt(this.src,this.id,t,n,this.returnValue).catch(function(i){if(jn(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var t=this;return!t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?Promise.resolve(ye):t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(n){return n.last_seq||ye}).catch(function(n){if(n.status!==404)throw n;return ye}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||ye:t.src.get(t.id).then(function(r){if(n.version!==r.version)return ye;var i;return n.version?i=n.version.toString():i="undefined",i in In?In[i](n,r):ye},function(r){if(r.status===404&&n.last_seq)return t.src.put({_id:t.id,last_seq:ye}).then(function(){return ye},function(i){return jn(i)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):ye});throw r})}).catch(function(n){if(n.status!==404)throw n;return ye})}}var In={undefined:function(e,t){return ne(e.last_seq,t.last_seq)===0?t.last_seq:0},1:function(e,t){return ba(t,e).last_seq}};function ba(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:Sr(e.history,t.history)}function Sr(e,t){var n=e[0],r=e.slice(1),i=t[0],s=t.slice(1);if(!n||t.length===0)return{last_seq:ye,history:[]};var u=n.session_id;if(Ft(u,t))return{last_seq:n.last_seq,history:e};var v=i.session_id;return Ft(v,r)?{last_seq:i.last_seq,history:s}:Sr(r,s)}function Ft(e,t){var n=t[0],r=t.slice(1);return!e||t.length===0?!1:e===n.session_id?!0:Ft(e,r)}function jn(e){return typeof e.status=="number"&&Math.floor(e.status/100)===4}function Ar(e,t,n,r,i){return this instanceof Bn?Ar:new Bn(e,t,n,r,i)}var $n=0;function Sa(e,t,n,r){if(e.retry===!1){t.emit("error",n),t.removeAllListeners();return}if(typeof e.back_off_function!="function"&&(e.back_off_function=Jr),t.emit("requestError",n),t.state==="active"||t.state==="pending"){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=$n},s=function(){t.removeListener("active",i)};t.once("paused",s),t.once("active",i)}e.current_back_off=e.current_back_off||$n,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function Aa(e){return Object.keys(e).sort(ne).reduce(function(t,n){return t[n]=e[n],t},{})}function qa(e,t,n){var r=n.doc_ids?n.doc_ids.sort(ne):"",i=n.filter?n.filter.toString():"",s="",u="",v="";return n.selector&&(v=JSON.stringify(n.selector)),n.filter&&n.query_params&&(s=JSON.stringify(Aa(n.query_params))),n.filter&&n.filter==="_view"&&(u=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(_){var y=_[0]+_[1]+i+u+s+r+v;return new Promise(function(w){tn(y,w)})}).then(function(_){return _=_.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+_})}function qr(e,t,n,r,i){var s=[],u,v={seq:0,changes:[],docs:[]},_=!1,y=!1,w=!1,l=0,g=0,m=n.continuous||n.live||!1,S=n.batch_size||100,O=n.batches_limit||10,p=n.style||"all_docs",h=!1,d=n.doc_ids,o=n.selector,a,c,f=[],q=ot(),C;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var E={};r.ready(e,t);function P(){return c?Promise.resolve():qa(e,t,n).then(function(x){a=x;var D={};n.checkpoint===!1?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},c=new Ar(e,t,a,r,D)})}function B(){if(f=[],u.docs.length!==0){var x=u.docs,D={timeout:n.timeout};return t.bulkDocs({docs:x,new_edits:!1},D).then(function(I){if(r.cancelled)throw b(),new Error("cancelled");var K=Object.create(null);I.forEach(function(Y){Y.error&&(K[Y.id]=Y)});var M=Object.keys(K).length;i.doc_write_failures+=M,i.docs_written+=x.length-M,x.forEach(function(Y){var ee=K[Y._id];if(ee){i.errors.push(ee);var re=(ee.name||"").toLowerCase();if(re==="unauthorized"||re==="forbidden")r.emit("denied",ae(ee));else throw ee}else f.push(Y)})},function(I){throw i.doc_write_failures+=x.length,I})}}function F(){if(u.error)throw new Error("There was a problem getting docs.");i.last_seq=g=u.seq;var x=ae(i);return f.length&&(x.docs=f,typeof u.pending=="number"&&(x.pending=u.pending,delete u.pending),r.emit("change",x)),_=!0,e.info().then(function(D){var I=e.activeTasks.get(C);if(!(!u||!I)){var K=I.completed_items||0,M=parseInt(D.update_seq,10)-parseInt(l,10);e.activeTasks.update(C,{completed_items:K+u.changes.length,total_items:M})}}),c.writeCheckpoint(u.seq,q).then(function(){if(r.emit("checkpoint",{checkpoint:u.seq}),_=!1,r.cancelled)throw b(),new Error("cancelled");u=void 0,R()}).catch(function(D){throw L(D),D})}function j(){var x={};return u.changes.forEach(function(D){r.emit("checkpoint",{revs_diff:D}),D.id!=="_user/"&&(x[D.id]=D.changes.map(function(I){return I.rev}))}),t.revsDiff(x).then(function(D){if(r.cancelled)throw b(),new Error("cancelled");u.diffs=D})}function N(){return ma(e,t,u.diffs,r).then(function(x){u.error=!x.ok,x.docs.forEach(function(D){delete u.diffs[D._id],i.docs_read++,u.docs.push(D)})})}function z(){if(!(r.cancelled||u)){if(s.length===0){Q(!0);return}u=s.shift(),r.emit("checkpoint",{start_next_batch:u.seq}),j().then(N).then(B).then(F).then(z).catch(function(x){W("batch processing terminated with error",x)})}}function Q(x){if(v.changes.length===0){s.length===0&&!u&&((m&&E.live||y)&&(r.state="pending",r.emit("paused")),y&&b());return}(x||y||v.changes.length>=S)&&(s.push(v),v={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),z())}function W(x,D){w||(D.message||(D.message=x),i.ok=!1,i.status="aborting",s=[],v={seq:0,changes:[],docs:[]},b(D))}function b(x){if(!w&&!(r.cancelled&&(i.status="cancelled",_)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=g,w=!0,e.activeTasks.remove(C,x),x){x=G(x),x.result=i;var D=(x.name||"").toLowerCase();D==="unauthorized"||D==="forbidden"?(r.emit("error",x),r.removeAllListeners()):Sa(n,r,x,function(){qr(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function A(x,D,I){if(r.cancelled)return b();typeof D=="number"&&(v.pending=D);var K=Wt(n)(x);if(!K){var M=e.activeTasks.get(C);if(M){var Y=M.completed_items||0;e.activeTasks.update(C,{completed_items:++Y})}return}v.seq=x.seq||I,v.changes.push(x),r.emit("checkpoint",{pending_batch:v.seq}),qe(function(){Q(s.length===0&&E.live)})}function T(x){if(h=!1,r.cancelled)return b();if(x.results.length>0)E.since=x.results[x.results.length-1].seq,R(),Q(!0);else{var D=function(){m?(E.live=!0,R()):y=!0,Q(!0)};!u&&x.results.length===0?(_=!0,c.writeCheckpoint(x.last_seq,q).then(function(){if(_=!1,i.last_seq=g=x.last_seq,r.cancelled)throw b(),new Error("cancelled");D()}).catch(L)):D()}}function k(x){if(h=!1,r.cancelled)return b();W("changes rejected",x)}function R(){if(!(!h&&!y&&s.length<O))return;h=!0;function x(){I.cancel()}function D(){r.removeListener("cancel",x)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",x);var I=e.changes(E).on("change",A);I.then(D,D),I.then(T).catch(k),n.retry&&(r._changes=I,r._abortChanges=x)}function $(x){return e.info().then(function(D){var I=typeof n.since>"u"?parseInt(D.update_seq,10)-parseInt(x,10):parseInt(D.update_seq,10);return C=e.activeTasks.add({name:`${m?"continuous ":""}replication from ${D.db_name}`,total_items:I}),x})}function U(){P().then(function(){if(r.cancelled){b();return}return c.getCheckpoint().then($).then(function(x){g=x,l=x,E={since:g,limit:S,batch_size:S,style:p,doc_ids:d,selector:o,return_docs:!0},n.filter&&(typeof n.filter!="string"?E.include_docs=!0:E.filter=n.filter),"heartbeat"in n&&(E.heartbeat=n.heartbeat),"timeout"in n&&(E.timeout=n.timeout),n.query_params&&(E.query_params=n.query_params),n.view&&(E.view=n.view),R()})}).catch(function(x){W("getCheckpoint rejected with ",x)})}function L(x){_=!1,W("writeCheckpoint completed with error",x)}if(r.cancelled){b();return}r._addedListeners||(r.once("cancel",b),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(x){n.complete(null,x)})),r._addedListeners=!0),typeof n.since>"u"?U():P().then(function(){return _=!0,c.writeCheckpoint(n.since,q)}).then(function(){if(_=!1,r.cancelled){b();return}g=n.since,U()}).catch(L)}class Oa extends Ce{constructor(){super(),this.cancelled=!1,this.state="pending";const t=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return t.then(n,r)},this.catch=function(n){return t.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(t,n){if(this._readyCalled)return;this._readyCalled=!0;const r=()=>{this.cancel()};t.once("destroyed",r),n.once("destroyed",r);function i(){t.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}}function st(e,t){var n=t.PouchConstructor;return typeof e=="string"?new n(e,t):e}function Ut(e,t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw G(at,"`doc_ids` filter parameter is not a list.");n.complete=r,n=ae(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new Oa(n),s=st(e,n),u=st(t,n);return qr(s,u,n,i),i}function Ca(e,t,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=ae(n),n.PouchConstructor=n.PouchConstructor||this,e=st(e,n),t=st(t,n),new xa(e,t,n,r)}class xa extends Ce{constructor(t,n,r,i){super(),this.canceled=!1;const s=r.push?Object.assign({},r,r.push):r,u=r.pull?Object.assign({},r,r.pull):r;this.push=Ut(t,n,s),this.pull=Ut(n,t,u),this.pushPaused=!0,this.pullPaused=!0;const v=o=>{this.emit("change",{direction:"pull",change:o})},_=o=>{this.emit("change",{direction:"push",change:o})},y=o=>{this.emit("denied",{direction:"push",doc:o})},w=o=>{this.emit("denied",{direction:"pull",doc:o})},l=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},g=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},m=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},S=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})};let O={};const p=o=>(a,c)=>{(a==="change"&&(c===v||c===_)||a==="denied"&&(c===w||c===y)||a==="paused"&&(c===g||c===l)||a==="active"&&(c===S||c===m))&&(a in O||(O[a]={}),O[a][o]=!0,Object.keys(O[a]).length===2&&this.removeAllListeners(a))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function h(o,a,c){o.listeners(a).indexOf(c)==-1&&o.on(a,c)}this.on("newListener",function(o){o==="change"?(h(this.pull,"change",v),h(this.push,"change",_)):o==="denied"?(h(this.pull,"denied",w),h(this.push,"denied",y)):o==="active"?(h(this.pull,"active",S),h(this.push,"active",m)):o==="paused"&&(h(this.pull,"paused",g),h(this.push,"paused",l))}),this.on("removeListener",function(o){o==="change"?(this.pull.removeListener("change",v),this.push.removeListener("change",_)):o==="denied"?(this.pull.removeListener("denied",w),this.push.removeListener("denied",y)):o==="active"?(this.pull.removeListener("active",S),this.push.removeListener("active",m)):o==="paused"&&(this.pull.removeListener("paused",g),this.push.removeListener("paused",l))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));const d=Promise.all([this.push,this.pull]).then(o=>{const a={push:o[0],pull:o[1]};return this.emit("complete",a),i&&i(null,a),this.removeAllListeners(),a},o=>{if(this.cancel(),i?i(o):this.emit("error",o),this.removeAllListeners(),i)throw o});this.then=function(o,a){return d.then(o,a)},this.catch=function(o){return d.catch(o)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}}function Ea(e){e.replicate=Ut,e.sync=Ca,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}}J.plugin(Gs).plugin(Zs).plugin(_a).plugin(Ea);const Qe=new J("todos");let Nn=!1;const Kn=[];function ka(e){Kn.push(e),Nn||(Qe.changes({live:!0,since:"now",include_docs:!0}).on("change",()=>Kn.forEach(t=>t())).on("error",t=>console.error("PouchDB changes error:",t)),Nn=!0)}async function Da(){return(await Qe.allDocs({include_docs:!0})).rows.map(t=>t.doc).filter(t=>!!t&&!!t._rev)}async function Ta(e){const t={_id:new Date().toISOString(),...e},n=await Qe.put(t);return{...t,_rev:n.rev}}async function Pa(e){const t={...e,completed:!e.completed},n=await Qe.put(t);return{...t,_rev:n.rev}}async function Ra(e){await Qe.remove(e._id,e._rev)}export{Ta as a,Ra as d,Da as g,Pa as t,ka as w};
